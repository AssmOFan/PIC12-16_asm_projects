MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;==============================================================================================
                      00002         INCLUDE HARDWARE_PROFILE.INC
                      00001         #INCLUDE P16F84.INC
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ;  MPASM PIC16F84 processor include
                      00005 ; 
                      00006 ;  (c) Copyright 1999-2013 Microchip Technology, All rights reserved
                      00007 ;==========================================================================
                      00008 
                      00206         LIST
                      00002 ;       list p=16f84
2007   3FF1           00003         __CONFIG _CP_OFF & _WDT_OFF & _PWRTE_ON & _XT_OSC
                      00004 ;==============================================================================================
                      00005         INCLUDE MICROMENU_LIB.H
                      00001 ; Микроменю на базе двухстрочного индикатора HD44780 и четырехпозиционного джойстика (крестовины кнопок)
                      00002 
Warning[205]: Found directive in column 1. (INCLUDE)
                      00003 INCLUDE HARDWARE_PROFILE.INC
                      00003         #INCLUDE P16F84.INC
                      00207         LIST
                      00208 
                      00209 ;==========================================================================
                      00210 ;  MPASM PIC16F84 processor include
                      00211 ; 
                      00212 ;  (c) Copyright 1999-2013 Microchip Technology, All rights reserved
                      00213 ;==========================================================================
                      00214 
Message[310]: Superseding current maximum RAM and RAM map.
                      00412         LIST
                      00004 ;       list p=16f84
Warning[205]: Found directive in column 1. (INCLUDE)
                      00004 INCLUDE MACRO.H 
                      00001 #DEFINE USE_SHORT_MOD_PCL       1       ; Использовать "укороченную" версию макроса модификации PCL, поз
                            воляет экономить 1 слово памяти на каждом вызове макроса ценой 1 лишней ячейки ОЗУ
                      00002 
                      00003 PUSH    MACRO
                      00004                 MOVWF   W_TEMP
                      00005                 SWAPF   STATUS,W
                      00006                 MOVWF   STATUS_TEMP
                      00007                 ENDM
                      00008 
                      00009 POP             MACRO
                      00010                 SWAPF   STATUS_TEMP,W
                      00011                 MOVWF   STATUS
                      00012                 SWAPF   W_TEMP,F
                      00013                 SWAPF   W_TEMP,W
                      00014                 ENDM
                      00015 
                      00016 CLR_RAM_MACRO   MACRO
                      00017                                 MOVLW   4FH             ; end of RAM
                      00018                                 MOVWF   FSR
MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00019                         CLR_RAM 
                      00020                                 CLRF    INDF
                      00021                                 DECF    FSR
                      00022                                 MOVFW   FSR
                      00023                                 SUBLW   0CH-1   ; start RAM
                      00024                                 BNZ             CLR_RAM
                      00025                                 ENDM
                      00026 
                      00027 MOD_PCL MACRO   TARGET                  ; Макрос, позволяет размещать таблицы на границах страниц
                      00028                 LOCAL   TABLE
                      00029                 MOVFW   TARGET
                      00030                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
                      00031                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                      00032         IF      USE_SHORT_MOD_PCL
                      00033                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
                      00034                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                      00035         ELSE
                      00036                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                      00037                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                      00038                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                      00039         ENDIF
                      00040                 MOVWF   PCLATH                  ; Установить старшую часть адреса
                      00041                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
                      00042                 MOVWF   PCL                             ; Установить младшую часть адреса
                      00043         TABLE
                      00044                 ENDM
                      00045 
                      00046 ADD_PCL MACRO   TARGET,ADDRESS  ; Макрос, позволяет удобно указывать страницу для следующего за ним кода
                      00047                                 MOVFW   TARGET  
                      00048                                 CLRF    PCLATH
                      00049                         IF      (ADDRESS==0X100)
                      00050                                 BSF             PCLATH,0
                      00051                         ENDIF
                      00052                         IF      (ADDRESS==0X200)
                      00053                                 BSF             PCLATH,1
                      00054                         ENDIF
                      00055                         IF      (ADDRESS==0X300)
                      00056                                 BSF             PCLATH,0                                
                      00057                                 BSF             PCLATH,1
                      00058                         ENDIF
                      00059                         IF      (ADDRESS==0X400)
                      00060                                 BSF             PCLATH,2                                
                      00061                         ENDIF
                      00062                                 ADDWF   PCL
                      00063                                 ENDM
                      00005 
                      00006 #DEFINE USE_STATIC_CURSOR               0                               ; Всегда рисовать курсор в конце
                             1-й строки
                      00007 #DEFINE USE_MOVING_CURSOR               1                               ; Использовать перемещаемый курс
                            ор (повышает удобство использования меню и размер прошивки)
                      00008 #DEFINE USE_TOP_LAST_CURSOR             1                               ; Использовать отображение "перв
                            ый пункт всегда сверху" и "последний пункт всегда снизу" (повышает удобство использования меню и
                      00009 #DEFINE SAVE_CURSOR_POSITION    1                               ; Сохранять позицию курсора при входе в 
MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            подменю, и восстанавливать ее при выходе в главное меню
                      00010 #DEFINE USE_MENU_ACTION                 1                               ; Использовать возможность запус
                            ка действий при входе в пункт меню
                      00011 #DEFINE USE_RBIE                                1                               ; Использовать прерывани
                            е по изминению состояния PORTB для обработки кнопок (позволяет использовать сон)
                      00012 
Warning[205]: Found directive in column 1. (IF)
                      00013 IF      USE_MENU_ACTION 
                      00014 #DEFINE ACTIONS_MENU_FLAGS              B'00000001'             ; Выставленный бит - есть действие при в
                            ходе в этот пункт меню (не забыть заполнить обработчик действия)
Warning[205]: Found directive in column 1. (ENDIF)
                      00015 ENDIF
                      00016 
                      00017 #DEFINE UP                                              PORTB,4
                      00018 #DEFINE DOWN                                    PORTB,5
                      00019 #DEFINE ENTER                                   PORTB,6
                      00020 #DEFINE EXIT                                    PORTB,7
                      00021 
                      00022 #DEFINE PRESS_UP                                BUTTONS,0
                      00023 #DEFINE PRESS_DOWN                              BUTTONS,1
                      00024 #DEFINE PRESS_EXIT                              BUTTONS,2
                      00025 #DEFINE PRESS_ENTER                             BUTTONS,3       
                      00026 
                      00027 ;#define        ZUMER                                   PORTA,0
                      00028 
                      00029 #DEFINE EXIT_DELAY                              .20                             ; Количество опросов кно
                            пок, до выхода в предыдущий уровень (* 0,8 сек)
                      00030 
                      00031 #DEFINE ZASTAVKA_FIRST_STRING   "  MicroMenuLib"
                      00032 #DEFINE ZASTAVKA_SECOND_STRING  "  ver 1.0 beta"
                      00033 
                      00034 #DEFINE NUM_OF_MAIN_MENU_PUNKTS .5                              ; Количество пунктов меню, до 10 
                      00035 
                      00036 #DEFINE MENU_NAME_1                             "1.Menu_1"
                      00037 #DEFINE MENU_NAME_2                             "2.Menu_2"
                      00038 #DEFINE MENU_NAME_3                             "3.Menu_3"
                      00039 #DEFINE MENU_NAME_4                             "4.Menu_4"
                      00040 #DEFINE MENU_NAME_5                             "5.Menu_5"
                      00041 #DEFINE MENU_NAME_6                             "6.Menu_6"      
                      00042 
                      00043 #DEFINE NUM_OF_SUBMENU_PUNKTS_1 .0                              ; Количество подпунктов каждого пункта м
                            еню, до 8
                      00044 
                      00045 #DEFINE MENU_SUBMENU_NAME_1_1   "1.1.Subm"
                      00046 #DEFINE MENU_SUBMENU_NAME_1_2   "1.2.Subm"
                      00047 #DEFINE MENU_SUBMENU_NAME_1_3   "1.3.Subm"
                      00048 #DEFINE MENU_SUBMENU_NAME_1_4   "1.4.Subm"
                      00049 
                      00050 #DEFINE NUM_OF_SUBMENU_PUNKTS_2 .1
                      00051 
                      00052 #DEFINE MENU_SUBMENU_NAME_2_1   "2.1.Subm"
                      00053 #DEFINE MENU_SUBMENU_NAME_2_2   "2.2.Subm"
                      00054 #DEFINE MENU_SUBMENU_NAME_2_3   "2.3.Subm"
MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00055 #DEFINE MENU_SUBMENU_NAME_2_4   "2.4.Subm"
                      00056                                 
                      00057 #DEFINE NUM_OF_SUBMENU_PUNKTS_3 .2
                      00058 
                      00059 #DEFINE MENU_SUBMENU_NAME_3_1   "3.1.Subm"
                      00060 #DEFINE MENU_SUBMENU_NAME_3_2   "3.2.Subm"
                      00061 #DEFINE MENU_SUBMENU_NAME_3_3   "3.3.Subm"
                      00062 #DEFINE MENU_SUBMENU_NAME_3_4   "3.4.Subm"
                      00063 
                      00064 #DEFINE NUM_OF_SUBMENU_PUNKTS_4 .3
                      00065 
                      00066 #DEFINE MENU_SUBMENU_NAME_4_1   "4.1.Subm"
                      00067 #DEFINE MENU_SUBMENU_NAME_4_2   "4.2.Subm"
                      00068 #DEFINE MENU_SUBMENU_NAME_4_3   "4.3.Subm"
                      00069 #DEFINE MENU_SUBMENU_NAME_4_4   "4.4.Subm"
                      00070 
                      00071 #DEFINE NUM_OF_SUBMENU_PUNKTS_5 .4
                      00072 
                      00073 #DEFINE MENU_SUBMENU_NAME_5_1   "5.1.Subm"
                      00074 #DEFINE MENU_SUBMENU_NAME_5_2   "5.2.Subm"
                      00075 #DEFINE MENU_SUBMENU_NAME_5_3   "5.3.Subm"
                      00076 #DEFINE MENU_SUBMENU_NAME_5_4   "5.4.Subm"
                      00077 ;=======================================================================================================
                            =========
                      00078 CREATE_MENU_NAMES       MACRO                           ; Макрос, создает имена всех пунктов меню
                      00079                         LOCAL   A=1
                      00080                                 WHILE   A<NUM_OF_MAIN_MENU_PUNKTS+1
                      00081                                 MENU_#V(A)
                      00082                                         MOD_PCL SYMBOL_POINTER
                      00083                                         DT              MENU_NAME_#V(A),0
                      00084                                         A+=1
                      00085                                 ENDW
                      00086                         ENDM
                      00087 ;=======================================================================================================
                            =========
                      00088 RETLW_NUM_OF_SUBMENU_PUNKTS     MACRO           ; Макрос, возвращает количество пунктов нужного подменю
                      00089                                 MOD_PCL INDEX_MENU
                      00090                         LOCAL   A=1
                      00091                                 WHILE   A<NUM_OF_MAIN_MENU_PUNKTS+1
                      00092                                         RETLW   NUM_OF_SUBMENU_PUNKTS_#V(A)
                      00093                                         A+=1
                      00094                                 ENDW
                      00095                         ENDM
                      00096 ;=======================================================================================================
                            =========
                      00097 GOTO_PUNKT_MENU MACRO                                   ; Макрос, создает переходы на все пункты меню
                      00098                                 MOD_PCL INDEX_MENU
                      00099                         LOCAL   A=1
                      00100                                 WHILE   A<NUM_OF_MAIN_MENU_PUNKTS+1
                      00101                                         GOTO    MENU_#V(A)
                      00102                                         A+=1
                      00103                                 ENDW
                      00104                         ENDM
MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00105 ;=======================================================================================================
                            =========
                      00106 GOTO_PUNKT_SUBMENU      MACRO                           ; Макрос, создает переходы на имена всех подпунк
                            тов меню
                      00107                                         MOD_PCL INDEX_MENU                              
                      00108                                         LOCAL   C=1
                      00109                                         WHILE   C<NUM_OF_MAIN_MENU_PUNKTS+1
                      00110                                                 GOTO    MENU_#V(C)_TABLE
                      00111                                                 C+=1
                      00112                                         ENDW
                      00113                                         LOCAL   D=1
                      00114                                         LOCAL   A
                      00115                                         WHILE           D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00116                                                 A=1     
                      00117                                                 MENU_#V(D)_TABLE
                      00118                                                 MOD_PCL INDEX_SUBMENU
                      00119                                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00120                                                         GOTO    MENU_#V(D)_SUBMENU_#V(A)
                      00121                                                         A+=1
                      00122                                                 ENDW
                      00123                                                 D+=1
                      00124                                         ENDW    
                      00125                                         ENDM
                      00126 ;=======================================================================================================
                            =========
                      00127 GOTO_PUNKT_SUBMENU_ACTION       MACRO           ; Макрос, создает переходы на действия всех подпунктов м
                            еню
                      00128                                                         MOD_PCL INDEX_MENU                              
                      00129                                                         LOCAL   C=1
                      00130                                                         WHILE   C<NUM_OF_MAIN_MENU_PUNKTS+1
                      00131                                                                 GOTO    MENU_#V(C)_TABLE_ACTION
                      00132                                                                 C+=1
                      00133                                                         ENDW
                      00134                                                         LOCAL   D=1
                      00135                                                         LOCAL   A
                      00136                                                         WHILE           D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00137                                                                 A=1     
                      00138                                                                 MENU_#V(D)_TABLE_ACTION
                      00139                                                                 MOD_PCL INDEX_SUBMENU
                      00140                                                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00141                                                                         GOTO    MENU_#V(D)_SUBMENU_#V(A)
                            _ACTION
                      00142                                                                         A+=1
                      00143                                                                 ENDW
                      00144                                                                 D+=1
                      00145                                                         ENDW
                      00146                                                         ENDM
                      00147 ;=======================================================================================================
                            =========
                      00148 CREATE_SUBMENU_NAMES_   MACRO                           ; Не работающий макрос создания имен всех подпун
                            ктов меню :(
                      00149                                                 LOCAL   D=1
                      00150                                                 LOCAL   A       
MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00151                                                 WHILE   D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00152                                                         A=1
                      00153                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1         
                                                                    
                      00154                                                                 MENU_#V(D)_SUBMENU_#V(A)
                      00155                                                                 MOD_PCL SYMBOL_POINTER
                      00156                                                                 DT      MENU_SUBMENU_NAME_#V(D)_#V(A),0
                      00157                                                                 A+=1
                      00158                                                         ENDW
                      00159                                                         D+=1
                      00160                                                 ENDW
                      00161                                                 ENDM
                      00162 ;=======================================================================================================
                            =========
                      00163 CREATE_SUBMENU_NAMES    MACRO                           ; Макрос, создает имена всех подпунктов меню
                      00164                                 LOCAL   D=1
                      00165 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00166 ; Подпункты 1 пункта меню
                      00167 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00168                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00169                                 LOCAL   A=1     
                      00170                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00171                                         MENU_#V(D)_SUBMENU_#V(A)
                      00172                                                 MOD_PCL SYMBOL_POINTER
                      00173                                                 DT              MENU_SUBMENU_NAME_1_#V(A),0
                      00174                                         A+=1
                      00175                                 ENDW
                      00176                                         D+=1
                      00177                                 ENDIF
                      00178 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00179 ; Подпункты 2 пункта меню
                      00180 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00181                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00182                                 LOCAL   A=1     
                      00183                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00184                                         MENU_#V(D)_SUBMENU_#V(A)
                      00185                                                 MOD_PCL SYMBOL_POINTER
                      00186                                                 DT              MENU_SUBMENU_NAME_2_#V(A),0
                      00187                                         A+=1
                      00188                                 ENDW
                      00189                                         D+=1
                      00190                                 ENDIF
                      00191 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00192 ; Подпункты 3 пункта меню
                      00193 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00194                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00195                                 LOCAL   A=1     
MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00196                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00197                                         MENU_#V(D)_SUBMENU_#V(A)
                      00198                                                 MOD_PCL SYMBOL_POINTER
                      00199                                                 DT              MENU_SUBMENU_NAME_3_#V(A),0
                      00200                                         A+=1
                      00201                                 ENDW
                      00202                                         D+=1
                      00203                                 ENDIF
                      00204 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00205 ; Подпункты 4 пункта меню
                      00206 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00207                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00208                                 LOCAL   A=1     
                      00209                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00210                                         MENU_#V(D)_SUBMENU_#V(A)
                      00211                                                 MOD_PCL SYMBOL_POINTER
                      00212                                                 DT              MENU_SUBMENU_NAME_4_#V(A),0
                      00213                                         A+=1
                      00214                                 ENDW
                      00215                                         D+=1
                      00216                                 ENDIF
                      00217 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00218 ; Подпункты 5 пункта меню
                      00219 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00220                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00221                                 LOCAL   A=1     
                      00222                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00223                                         MENU_#V(D)_SUBMENU_#V(A)
                      00224                                                 MOD_PCL SYMBOL_POINTER
                      00225                                                 DT              MENU_SUBMENU_NAME_5_#V(A),0
                      00226                                         A+=1
                      00227                                 ENDW
                      00228                                         D+=1
                      00229                                 ENDIF
                      00230 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00231 ; Подпункты 6 пункта меню
                      00232 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00233                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00234                                 LOCAL   A=1     
                      00235                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00236                                         MENU_#V(D)_SUBMENU_#V(A)
                      00237                                                 MOD_PCL SYMBOL_POINTER
                      00238                                                 DT              MENU_SUBMENU_NAME_6_#V(A),0
                      00239                                         A+=1
                      00240                                 ENDW
                      00241                                         D+=1
                      00242                                 ENDIF
MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00243 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00244 ; Подпункты 7 пункта меню
                      00245 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00246                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00247                                 LOCAL   A=1     
                      00248                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00249                                         MENU_#V(D)_SUBMENU_#V(A)
                      00250                                                 MOD_PCL SYMBOL_POINTER
                      00251                                                 DT              MENU_SUBMENU_NAME_7_#V(A),0
                      00252                                         A+=1
                      00253                                 ENDW
                      00254                                         D+=1
                      00255                                 ENDIF
                      00256 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00257 ; Подпункты 8 пункта меню
                      00258 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00259                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00260                                 LOCAL   A=1     
                      00261                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00262                                         MENU_#V(D)_SUBMENU_#V(A)
                      00263                                                 MOD_PCL SYMBOL_POINTER
                      00264                                                 DT              MENU_SUBMENU_NAME_8_#V(A),0
                      00265                                         A+=1
                      00266                                 ENDW
                      00267                                         D+=1
                      00268                                 ENDIF
                      00269 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00270                         ENDM
                      00271 ;=======================================================================================================
                            =========
Warning[205]: Found directive in column 1. (IF)
                      00272 IF      USE_MENU_ACTION 
                      00273 GOTO_MENU_ACTION        MACRO           ; Макрос, создает переходы на действия всех пунктов меню (если в
                            ключена соответствующая опция)
                      00274                                         MOD_PCL INDEX_MENU                      
                      00275                                         LOCAL   A=1
                      00276                                 WHILE   A<NUM_OF_MAIN_MENU_PUNKTS+1
                      00277                                         GOTO    MENU_#V(A)_ACTION
                      00278                                         A+=1
                      00279                                 ENDW
                      00280                                         ENDM
Warning[205]: Found directive in column 1. (ENDIF)
                      00281 ENDIF
                      00282 ;=======================================================================================================
                            =========
                      00283 MICROMENU_INIT  MACRO
                      00284                                 CALL    LCD_INIT                                        ; Инициалзация с
                            амого дисплея   
MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00285                                 CLRF    BUTTONS                                         ; Очистим флаги 
                            нажатых кнопок
                      00286                                 IF      USE_RBIE
                      00287                                 BCF             INTCON,RBIF                     
                      00288                                 MOVLW   1<<RBIE|1<<GIE
                      00289                                 IORWF   INTCON
                      00290                                 ENDIF
                      00291                                 ENDM
                      00292 ;=======================================================================================================
                            =========
Warning[205]: Found directive in column 1. (IF)
                      00293 IF      USE_RBIE
                      00294 BUTTON_HEANDLER MACRO                                                           ; Обработчик нажатия кно
                            пок
                      00295                                 BCF             INTCON,RBIF                                     ; Сброси
                            м флаг вызваного прерывания
                      00296                                 MOVFW   PORTB                                           
                      00297                                 IORLW   B'00001111'                                     ; Установим незн
                            ачущие разряды
                      00298                                 ADDLW   .1
                      00299                                 BZ              END_INTERRUPT_HEANDLER          ; Если ни одна кнопка не
                             нажата, пропустим обработку нажатия
                      00300                                 BTFSS   UP
                      00301                                 BSF             PRESS_UP                
                      00302                                 BTFSS   DOWN
                      00303                                 BSF             PRESS_DOWN
                      00304                                 BTFSS   ENTER
                      00305                                 BSF             PRESS_ENTER
                      00306                                 BTFSS   EXIT
                      00307                                 BSF             PRESS_EXIT
                      00308                                 BCF             INTCON,RBIE                                     ; Запрет
                            им все дальнейшие прерывания от кнопок, до обработки этого нажатия
                      00309                                 ENDM
Warning[205]: Found directive in column 1. (ENDIF)
                      00310 ENDIF
                      00311 ;=======================================================================================================
                            =========
                      00312 CHECK_BUTTONS_MACRO     MACRO
                      00313                                         IF      USE_RBIE
                      00314                                         SLEEP
                      00315                                         NOP
                      00316                                         MOVFW   BUTTONS                                         
                      00317                                         ANDLW   B'00001111'                                     ; Занули
                            м незначущие разряды
                      00318                                         BNZ             MENU_HEANDLER                           ; Если х
                            оть одна кнопка нажата, входим в обработчик меню
                      00319                                 
                      00320                                         ELSE
                      00321                                         MOVFW   PORTB                                           
                      00322                                         IORLW   B'00001111'                                     ; Устано
                            вим незначущие разряды
                      00323                                         ADDLW   .1
                      00324                                         BNZ             MENU_HEANDLER                           ; Если х
MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            оть одна кнопка нажата, входим в обработчик меню
                      00325                                         ENDIF
                      00326                                         ENDM
                      00327 ;=======================================================================================================
                            =========
                      00006 ;==============================================================================================
                      00007 MAIN_UDATA      UDATA_SHR
0000                  00008 W_TEMP          RES     1
0001                  00009 STATUS_TEMP     RES     1
0002                  00010 OFFSET          RES     1                                               ; Используется в макросе модифик
                            ации PCL
                      00011 ;==============================================================================================
                      00012         IF      USE_SHORT_MOD_PCL
0003                  00013 KNOWN_ZERO      RES     1                                               ; Используется в укороченной вер
                            сии макроса модификации PCL
  0000                00014         GLOBAL  KNOWN_ZERO
                      00015         ENDIF
                      00016 ;== Переменные ================================================================================
  0000                00017         GLOBAL  OFFSET
  0000                00018         EXTERN  BUTTONS
                      00019 ;== Подпрограммы, метки =======================================================================
  0000                00020         GLOBAL  END_INTERRUPT_HEANDLER,MAIN
  0000                00021         EXTERN  LCD_LINE_INIT,LCD_INIT
  0000                00022         EXTERN  MENU_HEANDLER,ZASTAVKA
                      00023 ;==============================================================================================
                      00024 RESET_VECTOR    CODE    0H
0000   2???           00025         GOTO    INIT
                      00026 ;==============================================================================================
                      00027 ISR                             CODE    4H                              ; Вектор прерывания
0004                  00028 INTERRUPT_HEANDLER
                      00029         PUSH                                                            ; Сохраним контекст
0004   00??               M                 MOVWF   W_TEMP
0005   0E03               M                 SWAPF   STATUS,W
0006   00??               M                 MOVWF   STATUS_TEMP
                      00030         BUTTON_HEANDLER
0007   100B               M                                 BCF             INTCON,RBIF                                     ; Сброси
                            м флаг вызваного прерывания
0008   0806               M                                 MOVFW   PORTB                                           
0009   380F               M                                 IORLW   B'00001111'                                     ; Установим незн
                            ачущие разряды
000A   3E01               M                                 ADDLW   .1
000B   1903 2???          M                                 BZ              END_INTERRUPT_HEANDLER          ; Если ни одна кнопка не
                             нажата, пропустим обработку нажатия
000D   1E06               M                                 BTFSS   UP
000E   1400               M                                 BSF             PRESS_UP                
000F   1E86               M                                 BTFSS   DOWN
0010   1480               M                                 BSF             PRESS_DOWN
0011   1F06               M                                 BTFSS   ENTER
0012   1580               M                                 BSF             PRESS_ENTER
0013   1F86               M                                 BTFSS   EXIT
0014   1500               M                                 BSF             PRESS_EXIT
0015   118B               M                                 BCF             INTCON,RBIE                                     ; Запрет
                            им все дальнейшие прерывания от кнопок, до обработки этого нажатия
MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0016                  00031 END_INTERRUPT_HEANDLER
                      00032         POP                                                                     ; Восстановим контекст  
0016   0E??               M                 SWAPF   STATUS_TEMP,W
0017   0083               M                 MOVWF   STATUS
0018   0E??               M                 SWAPF   W_TEMP,F
0019   0E??               M                 SWAPF   W_TEMP,W
001A   0009           00033         RETFIE
                      00034 ;==============================================================================================
001B                  00035 INIT
                      00036         CLR_RAM_MACRO                                           ; Макрос очистки памяти. Требует коррекц
                            ии диапазона под каждый конкретный МК (см. datasheet)
001B   304F               M                                 MOVLW   4FH             ; end of RAM
001C   0084               M                                 MOVWF   FSR
Warning[207]: Found label after column 1. (CLR_RAM)
001D                      M                         CLR_RAM 
001D   0180               M                                 CLRF    INDF
Message[305]: Using default destination of 1 (file).
001E   0384               M                                 DECF    FSR
001F   0804               M                                 MOVFW   FSR
0020   3C0B               M                                 SUBLW   0CH-1   ; start RAM
0021   1D03 2???          M                                 BNZ             CLR_RAM
0023   1683           00037         BANKSEL OPTION_REG
0024   3000           00038         MOVLW   B'00000000'                                     ; Enable pull-ups resistors on PortB
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0025   0081           00039         MOVWF   OPTION_REG
0026   2???           00040         CALL    LCD_LINE_INIT                           ; Инициализация линий управления и шины данных д
                            ля работы с дисплеем
0027   1283           00041         BANKSEL TMR0
                      00042         MICROMENU_INIT                                          ; Инициализация MicroMenu       
0028   2???               M                                 CALL    LCD_INIT                                        ; Инициалзация с
                            амого дисплея   
0029   01??               M                                 CLRF    BUTTONS                                         ; Очистим флаги 
                            нажатых кнопок
                          M                                 IF      USE_RBIE
002A   100B               M                                 BCF             INTCON,RBIF                     
002B   3088               M                                 MOVLW   1<<RBIE|1<<GIE
Message[305]: Using default destination of 1 (file).
002C   048B               M                                 IORWF   INTCON
                          M                                 ENDIF
002D   2???           00043         GOTO    ZASTAVKA                                        ; Выведем на экран заставку
002E                  00044 MAIN
                      00045         CHECK_BUTTONS_MACRO     
                          M                                         IF      USE_RBIE
002E   0063               M                                         SLEEP
002F   0000               M                                         NOP
0030   08??               M                                         MOVFW   BUTTONS                                         
0031   390F               M                                         ANDLW   B'00001111'                                     ; Занули
                            м незначущие разряды
0032   1D03 2???          M                                         BNZ             MENU_HEANDLER                           ; Если х
                            оть одна кнопка нажата, входим в обработчик меню
                          M                                 
                          M                                         ELSE
                          M                                         MOVFW   PORTB                                           
MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M                                         IORLW   B'00001111'                                     ; Устано
                            вим незначущие разряды
                          M                                         ADDLW   .1
                          M                                         BNZ             MENU_HEANDLER                           ; Если х
                            оть одна кнопка нажата, входим в обработчик меню
                          M                                         ENDIF
0034   2???           00046         GOTO    MAIN                                            ; Иначе продолжаем опрос кнопок
                      00047 ;==============================================================================================
3FF1                  00048         END
MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE 13


SYMBOL TABLE
  LABEL                             VALUE 

ACTIONS_MENU_FLAGS                B'00000001'
ADD_PCL                           
BUTTONS                           00000000
BUTTON_HEANDLER                   
C                                 00000000
CHECK_BUTTONS_MACRO               
CLR_RAM                           0000001D
CLR_RAM_MACRO                     
CREATE_MENU_NAMES                 
CREATE_SUBMENU_NAMES              
CREATE_SUBMENU_NAMES_             
DC                                00000001
DOWN                              PORTB,5
EEADR                             00000009
EECON1                            00000088
EECON2                            00000089
EEDATA                            00000008
EEIE                              00000006
EEIF                              00000004
END_INTERRUPT_HEANDLER            00000016
ENTER                             PORTB,6
EXIT                              PORTB,7
EXIT_DELAY                        .20
F                                 00000001
FSR                               00000004
GIE                               00000007
GOTO_MENU_ACTION                  
GOTO_PUNKT_MENU                   
GOTO_PUNKT_SUBMENU                
GOTO_PUNKT_SUBMENU_ACTION         
INDF                              00000000
INIT                              0000001B
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTERRUPT_HEANDLER                00000004
INTF                              00000001
IRP                               00000007
KNOWN_ZERO                        00000003
LCD_INIT                          00000000
LCD_LINE_INIT                     00000000
MAIN                              0000002E
MENU_HEANDLER                     00000000
MENU_NAME_1                       "1.Menu_1"
MENU_NAME_2                       "2.Menu_2"
MENU_NAME_3                       "3.Menu_3"
MENU_NAME_4                       "4.Menu_4"
MENU_NAME_5                       "5.Menu_5"
MENU_NAME_6                       "6.Menu_6"
MENU_SUBMENU_NAME_1_1             "1.1.Subm"
MENU_SUBMENU_NAME_1_2             "1.2.Subm"
MENU_SUBMENU_NAME_1_3             "1.3.Subm"
MENU_SUBMENU_NAME_1_4             "1.4.Subm"
MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE 14


SYMBOL TABLE
  LABEL                             VALUE 

MENU_SUBMENU_NAME_2_1             "2.1.Subm"
MENU_SUBMENU_NAME_2_2             "2.2.Subm"
MENU_SUBMENU_NAME_2_3             "2.3.Subm"
MENU_SUBMENU_NAME_2_4             "2.4.Subm"
MENU_SUBMENU_NAME_3_1             "3.1.Subm"
MENU_SUBMENU_NAME_3_2             "3.2.Subm"
MENU_SUBMENU_NAME_3_3             "3.3.Subm"
MENU_SUBMENU_NAME_3_4             "3.4.Subm"
MENU_SUBMENU_NAME_4_1             "4.1.Subm"
MENU_SUBMENU_NAME_4_2             "4.2.Subm"
MENU_SUBMENU_NAME_4_3             "4.3.Subm"
MENU_SUBMENU_NAME_4_4             "4.4.Subm"
MENU_SUBMENU_NAME_5_1             "5.1.Subm"
MENU_SUBMENU_NAME_5_2             "5.2.Subm"
MENU_SUBMENU_NAME_5_3             "5.3.Subm"
MENU_SUBMENU_NAME_5_4             "5.4.Subm"
MICROMENU_INIT                    
MOD_PCL                           
NOT_PD                            00000003
NOT_RBPU                          00000007
NOT_TO                            00000004
NUM_OF_MAIN_MENU_PUNKTS           .5
NUM_OF_SUBMENU_PUNKTS_1           .0
NUM_OF_SUBMENU_PUNKTS_2           .1
NUM_OF_SUBMENU_PUNKTS_3           .2
NUM_OF_SUBMENU_PUNKTS_4           .3
NUM_OF_SUBMENU_PUNKTS_5           .4
OFFSET                            00000002
OPTION_REG                        00000081
PCL                               00000002
PCLATH                            0000000A
POP                               
PORTA                             00000005
PORTB                             00000006
PRESS_DOWN                        BUTTONS,1
PRESS_ENTER                       BUTTONS,3
PRESS_EXIT                        BUTTONS,2
PRESS_UP                          BUTTONS,0
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PUSH                              
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE 15


SYMBOL TABLE
  LABEL                             VALUE 

RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RD                                00000000
RETLW_NUM_OF_SUBMENU_PUNKTS       
RP0                               00000005
RP1                               00000006
SAVE_CURSOR_POSITION              1
STATUS                            00000003
STATUS_TEMP                       00000001
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
UP                                PORTB,4
USE_MENU_ACTION                   1
USE_MOVING_CURSOR                 1
USE_RBIE                          1
USE_SHORT_MOD_PCL                 1
USE_STATIC_CURSOR                 0
USE_TOP_LAST_CURSOR               1
W                                 00000000
WR                                00000001
WREN                              00000002
WRERR                             00000003
W_TEMP                            00000000
Z                                 00000002
ZASTAVKA                          00000000
ZASTAVKA_FIRST_STRING             "  MicroMenuLib"
ZASTAVKA_SECOND_STRING            "  ver 1.0 beta"
_CONFIG                           00002007
_CP_OFF                           00003FFF
_CP_ON                            0000000F
MPASM  5.51                          MAIN.ASM   12-24-2018  10:37:53         PAGE 16


SYMBOL TABLE
  LABEL                             VALUE 

_FOSC_EXTRC                       00003FFF
_FOSC_HS                          00003FFE
_FOSC_LP                          00003FFC
_FOSC_XT                          00003FFD
_HS_OSC                           00003FFE
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_LP_OSC                           00003FFC
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDTE_OFF                         00003FFB
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_XT_OSC                           00003FFD
__16F84                           00000001

Errors   :     0
Warnings :     9 reported,     0 suppressed
Messages :     4 reported,     0 suppressed

