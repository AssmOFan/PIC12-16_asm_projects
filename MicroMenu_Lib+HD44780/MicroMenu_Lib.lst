MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001         INCLUDE MICROMENU_LIB.H
                      00001 ; Микроменю на базе двухстрочного индикатора HD44780 и четырехпозиционного джойстика (крестовины кнопок)
                      00002 ; Библиотека построена на основе "индексов". Меню имеет 2 уровня вложености (вход в пункт меню + вход в 
                            подпункт меню)
                      00003 ; При навигации по меню изменяются номера ("индексы") текущего пункта меню и текущего подпункта меню
                      00004 ; На основе этих данных и выводится информация на дисплей/совершаются действия
                      00005 
Warning[205]: Found directive in column 1. (INCLUDE)
                      00006 INCLUDE HARDWARE_PROFILE.INC
                      00001         INCLUDE P16F84.INC
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ;  MPASM PIC16F84 processor include
                      00005 ; 
                      00006 ;  (c) Copyright 1999-2013 Microchip Technology, All rights reserved
                      00007 ;==========================================================================
                      00008 
                      00206         LIST
                      00002         LIST P=16F84
Warning[205]: Found directive in column 1. (INCLUDE)
                      00007 INCLUDE MACRO.H
                      00001 
                      00002 #DEFINE USE_SHORT_MOD_PCL       1       ; Использовать "укороченную" версию макроса модификации PCL, поз
                            воляет экономить 1 слово памяти на каждом вызове макроса ценой 1 лишней ячейки ОЗУ
                      00003 
                      00004 PUSH    MACRO
                      00005                 MOVWF   W_TEMP
                      00006                 SWAPF   STATUS,W
                      00007                 MOVWF   STATUS_TEMP
                      00008                 ENDM
                      00009 
                      00010 POP             MACRO
                      00011                 SWAPF   STATUS_TEMP,W
                      00012                 MOVWF   STATUS
                      00013                 SWAPF   W_TEMP,F
                      00014                 SWAPF   W_TEMP,W
                      00015                 ENDM
                      00016 
                      00017 MOD_PCL MACRO   TARGET                  ; Макрос, позволяет размещать таблицы на границах страниц
                      00018                 LOCAL   TABLE
                      00019                 MOVFW   TARGET
                      00020                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
                      00021                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                      00022         IF      USE_SHORT_MOD_PCL
                      00023                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
                      00024                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                      00025         ELSE
                      00026                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                      00027                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                      00028                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                      00029         ENDIF
                      00030                 MOVWF   PCLATH                  ; Установить старшую часть адреса
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00031                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
                      00032                 MOVWF   PCL                             ; Установить младшую часть адреса
                      00033         TABLE
                      00034                 ENDM
                      00035 
                      00036 ADD_PCL MACRO   TARGET,ADDRESS  ; Макрос, позволяет удобно указывать страницу для следующего за ним кода
                      00037                                 MOVFW   TARGET  
                      00038                                 CLRF    PCLATH
                      00039                         IF      (ADDRESS==0X100)
                      00040                                 BSF             PCLATH,0
                      00041                         ENDIF
                      00042                         IF      (ADDRESS==0X200)
                      00043                                 BSF             PCLATH,1
                      00044                         ENDIF
                      00045                         IF      (ADDRESS==0X300)
                      00046                                 BSF             PCLATH,0                                
                      00047                                 BSF             PCLATH,1
                      00048                         ENDIF
                      00049                         IF      (ADDRESS==0X400)
                      00050                                 BSF             PCLATH,2                                
                      00051                         ENDIF
                      00052                                 ADDWF   PCL
                      00053                                 ENDM
Warning[205]: Found directive in column 1. (INCLUDE)
                      00008 INCLUDE HD44780_LIB.H
Warning[205]: Found directive in column 1. (INCLUDE)
                      00001 INCLUDE HARDWARE_PROFILE.INC
                      00003         INCLUDE P16F84.INC
                      00207         LIST
                      00208 
                      00209 ;==========================================================================
                      00210 ;  MPASM PIC16F84 processor include
                      00211 ; 
                      00212 ;  (c) Copyright 1999-2013 Microchip Technology, All rights reserved
                      00213 ;==========================================================================
                      00214 
Message[310]: Superseding current maximum RAM and RAM map.
                      00412         LIST
                      00004         LIST P=16F84
                      00002 
  00000001            00003 Y                               EQU             1                               ; YES
  00000000            00004 N                               EQU             0                               ; NO
                      00005 
  00000001            00006 USE_4_BIT_MODE  EQU             Y                               ; YES/NO
  00000000            00007 USE_HIGH_NIBLE  EQU             N                               ; YES/NO
  00000000            00008 USE_ONE_PORT    EQU             N                               ; YES/NO
  00000001            00009 ONLY_WRITE              EQU             Y                               ; YES/NO
                      00010 
  00000006            00011 LCD_DATA                EQU             PORTB                   ; Описываем порт линий данных
  00000086            00012 LCD_DATA_TRIS   EQU             TRISB
                      00013 
                      00014         IF      (USE_4_BIT_MODE && USE_ONE_PORT); ; Если используем один порт для данных и линий управле
                            ниЯ
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00015 
                      00016 LCD_CNTL                EQU             LCD_DATA                ; то так и опишем
                      00017 LCD_CNTL_TRIS   EQU             LCD_DATA_TRIS
                      00018 
                      00019         ELSE
                      00020 
  00000005            00021 LCD_CNTL                EQU             PORTA                   ; Иначе зададим любой другой
  00000085            00022 LCD_CNTL_TRIS   EQU             TRISA
                      00023         ENDIF
                      00024         
                      00025         IF      (USE_4_BIT_MODE && USE_ONE_PORT && USE_HIGH_NIBLE && ONLY_WRITE)
                      00026 E                               EQU             2
                      00027 RS                              EQU             3
                      00028 CNTL_TRIS_MASK  EQU             B'11110011'             ; Маска настройки линий управлениЯ
                      00029         ENDIF
                      00030 
                      00031         IF      (USE_4_BIT_MODE && USE_ONE_PORT && USE_HIGH_NIBLE && !ONLY_WRITE)
                      00032 E                               EQU             1
                      00033 RW                              EQU             2
                      00034 RS                              EQU             3
                      00035 CNTL_TRIS_MASK  EQU             B'11110001'             ; Маска настройки линий управлениЯ
                      00036         ENDIF   
                      00037 
                      00038         IF      (USE_4_BIT_MODE && USE_ONE_PORT && !USE_HIGH_NIBLE && ONLY_WRITE)
                      00039 E                               EQU             4
                      00040 RS                              EQU             5
                      00041 CNTL_TRIS_MASK  EQU             B'11001111'             ; Маска настройки линий управлениЯ
                      00042         ENDIF   
                      00043 
                      00044         IF      (USE_4_BIT_MODE && USE_ONE_PORT && !USE_HIGH_NIBLE && !ONLY_WRITE)
                      00045 E                               EQU             4
                      00046 RW                              EQU             5
                      00047 RS                              EQU             6
                      00048 CNTL_TRIS_MASK  EQU             B'10001111'             ; Маска настройки линий управлениЯ
                      00049 
                      00050         ELSE    ; Иначе присваиваем контрольным линиям любой другой порт и вибираем линии их по своему у
                            смотрению
                      00051         
  00000001            00052 E                               EQU             1
  00000003            00053 RS                              EQU             3
  000000F5            00054 CNTL_TRIS_MASK  EQU             B'11110101'             ; Маска настройки линий управления
                      00055         ENDIF
                      00056 
  0000000C            00057 DISP_ON                 EQU             B'00001100'             ; Display on
  0000000E            00058 DISP_ON_C               EQU             B'00001110'             ; Display on, Cursor on
  0000000F            00059 DISP_ON_B               EQU             B'00001111'             ; Display on, Cursor on, Blink cursor
  00000008            00060 DISP_OFF                EQU             B'00001000'             ; Display off
  00000001            00061 CLR_DISP                EQU             B'00000001'             ; Clear the Display
  00000006            00062 ENTRY_INC               EQU             B'00000110'             ; автоинкремент адреса, нет сдвига 
  00000007            00063 ENTRY_INC_S             EQU             B'00000111'             ; автоинкремент адреса, есть сдвиг
  00000004            00064 ENTRY_DEC               EQU             B'00000100'             ; автоинкремент адреса, нет сдвига 
  00000005            00065 ENTRY_DEC_S             EQU             B'00000101'             ;
  00000080            00066 DD_RAM_ADDR             EQU             B'10000000'             ; Least Significant 7-bit are for addres
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            s
  00000080            00067 DD_RAM_UL               EQU             B'10000000'             ; Upper Left coner of the Display
  000000C0            00068 SECOND_LINE             EQU             B'11000000'             ; Move cursor to second line
  0000008F            00069 LAST_SYMBOL_FIRST_LINE  EQU     B'10001111'     ; Установим курсор на последний символ 1-й строки
  000000CF            00070 LAST_SYMBOL_SECOND_LINE EQU     B'11001111'     ; Установим курсор на последний символ 2-й строки       
                                                            
                      00009 
                      00010 #DEFINE USE_STATIC_CURSOR               0                               ; Всегда рисовать курсор в конце
                             1-й строки
                      00011 #DEFINE USE_MOVING_CURSOR               1                               ; Использовать перемещаемый курс
                            ор (повышает удобство использования меню и размер прошивки)
                      00012 #DEFINE USE_TOP_LAST_CURSOR             1                               ; Использовать отображение "перв
                            ый пункт всегда сверху" и "последний пункт всегда снизу" (повышает удобство использования меню и
                      00013 #DEFINE USE_RBIE                                1                               ; Использовать прерывани
                            е по изминению состояния PORTB для обработки кнопок (позволяет использовать сон)
                      00014 #DEFINE USE_MENU_ACTION                 0                               ; Использовать возможность запус
                            ка действий при входе в пункт меню (повышает размер прошивки)
                      00015 
Warning[205]: Found directive in column 1. (IF)
                      00016 IF      USE_MENU_ACTION 
                      00017 #DEFINE ACTIONS_MENU_FLAGS              B'00000000'             ; Выставленный бит - есть действие при в
                            ходе в этот пункт меню (не забыть заполнить обработчик действия !!!)
                      00018 ENDIF
                      00019 
                      00020 #DEFINE UP                                              PORTB,4
                      00021 #DEFINE DOWN                                    PORTB,5
                      00022 #DEFINE ENTER                                   PORTB,6
                      00023 #DEFINE EXIT                                    PORTB,7
                      00024 
                      00025 #DEFINE PRESS_UP                                FLAGS,0
                      00026 #DEFINE PRESS_DOWN                              FLAGS,1
                      00027 #DEFINE PRESS_ENTER                             FLAGS,2
                      00028 #DEFINE PRESS_EXIT                              FLAGS,3
                      00029         
                      00030 #DEFINE EXIT_DELAY                              .20                             ; Количество опросов кно
                            пок, до автовыхода в предыдущий уровень (* 0,8 сек)
                      00031 
                      00032 #DEFINE ZASTAVKA_FIRST_STRING   "  MicroMenuLib"
                      00033 #DEFINE ZASTAVKA_SECOND_STRING  "  ver 1.0 beta"
                      00034 
                      00035 #DEFINE ACTION_COMPLETE_STRING  "Action Complete!"
                      00036 
                      00037 #DEFINE NUM_OF_MAIN_MENU_PUNKTS .5                              ; Количество пунктов меню, до 8 (можно и
                             больше, но действия при входе в меню доступны только для первых 8 пунктов) 
                      00038 
                      00039 #DEFINE MENU_NAME_1                             "1.Menu_1"
                      00040 #DEFINE MENU_NAME_2                             "2.Menu_2"
                      00041 #DEFINE MENU_NAME_3                             "3.Menu_3"
                      00042 #DEFINE MENU_NAME_4                             "4.Menu_4"
                      00043 #DEFINE MENU_NAME_5                             "5.Menu_5"      
                      00044 
                      00045 #DEFINE NUM_OF_SUBMENU_PUNKTS_1 .0                              ; Количество подпунктов каждого пункта м
                            еню (в теории до 64, но больше 8 не проверялось, памяти в контроллере не хватило)
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00046                                                                                                 ; Не заб
                            ываем оформить обработчик для каждого действия !!!
                      00047 #DEFINE MENU_SUBMENU_NAME_1_1   "1.1.SubMenu"
                      00048 #DEFINE MENU_SUBMENU_NAME_1_2   "1.2.SubMenu"
                      00049 #DEFINE MENU_SUBMENU_NAME_1_3   "1.3.SubMenu"
                      00050 
                      00051 #DEFINE NUM_OF_SUBMENU_PUNKTS_2 .1
                      00052 
                      00053 #DEFINE MENU_SUBMENU_NAME_2_1   "2.1.SubMenu"
                      00054 #DEFINE MENU_SUBMENU_NAME_2_2   "2.2.SubMenu"
                      00055 #DEFINE MENU_SUBMENU_NAME_2_3   "2.3.SubMenu"
                      00056                                 
                      00057 #DEFINE NUM_OF_SUBMENU_PUNKTS_3 .2
                      00058 
                      00059 #DEFINE MENU_SUBMENU_NAME_3_1   "3.1.SubMenu"
                      00060 #DEFINE MENU_SUBMENU_NAME_3_2   "3.2.SubMenu"
                      00061 #DEFINE MENU_SUBMENU_NAME_3_3   "3.3.SubMenu"
                      00062 
                      00063 #DEFINE NUM_OF_SUBMENU_PUNKTS_4 .3
                      00064 
                      00065 #DEFINE MENU_SUBMENU_NAME_4_1   "4.1.SubMenu"
                      00066 #DEFINE MENU_SUBMENU_NAME_4_2   "4.2.SubMenu"
                      00067 #DEFINE MENU_SUBMENU_NAME_4_3   "4.3.SubMenu"
                      00068 
                      00069 #DEFINE NUM_OF_SUBMENU_PUNKTS_5 .3
                      00070 
                      00071 #DEFINE MENU_SUBMENU_NAME_5_1   "5.1.SubMenu"
                      00072 #DEFINE MENU_SUBMENU_NAME_5_2   "5.2.SubMenu"
                      00073 #DEFINE MENU_SUBMENU_NAME_5_3   "5.3.SubMenu"
                      00074 
                      00075 ;=======================================================================================================
                            =========
                      00076 CREATE_MENU_NAMES       MACRO                           ; Макрос, создает имена всех пунктов меню
                      00077                                         LOCAL   A=1
                      00078                                         WHILE   A<NUM_OF_MAIN_MENU_PUNKTS+1
                      00079                                                 MENU_#V(A)
                      00080                                                 MOD_PCL SYMBOL_POINTER
                      00081                                                 DT              MENU_NAME_#V(A),0
                      00082                                                 A+=1
                      00083                                         ENDW
                      00084                                         ENDM
                      00085 ;=======================================================================================================
                            =========
                      00086 RETLW_NUM_OF_SUBMENU_PUNKTS     MACRO           ; Макрос, возвращает количество пунктов нужного подменю
                      00087                                                         MOD_PCL INDEX_MENU
                      00088                                                         LOCAL   A=1
                      00089                                                         WHILE   A<NUM_OF_MAIN_MENU_PUNKTS+1
                      00090                                                                 RETLW   NUM_OF_SUBMENU_PUNKTS_#V(A)
                      00091                                                                 A+=1
                      00092                                                         ENDW
                      00093                                                         ENDM
                      00094 ;=======================================================================================================
                            =========
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00095 GOTO_PUNKT_MENU MACRO                                   ; Макрос, создает переходы на все пункты меню
                      00096                                 MOD_PCL INDEX_MENU
                      00097                                 LOCAL   A=1
                      00098                                 WHILE   A<NUM_OF_MAIN_MENU_PUNKTS+1
                      00099                                         GOTO    MENU_#V(A)
                      00100                                         A+=1
                      00101                                 ENDW
                      00102                                 ENDM
                      00103 ;=======================================================================================================
                            =========
                      00104 GOTO_PUNKT_SUBMENU      MACRO                           ; Макрос, создает переходы на имена всех подпунк
                            тов меню
                      00105                                         MOD_PCL INDEX_MENU                              
                      00106                                         LOCAL   C=1
                      00107                                         WHILE   C<NUM_OF_MAIN_MENU_PUNKTS+1
                      00108                                                 GOTO    MENU_#V(C)_TABLE
                      00109                                                 C+=1
                      00110                                         ENDW
                      00111                                         LOCAL   D=1
                      00112                                         LOCAL   A
                      00113                                         WHILE           D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00114                                                 A=1     
                      00115                                                 MENU_#V(D)_TABLE
                      00116                                                 MOD_PCL INDEX_SUBMENU
                      00117                                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00118                                                         GOTO    MENU_#V(D)_SUBMENU_#V(A)
                      00119                                                         A+=1
                      00120                                                 ENDW
                      00121                                                 D+=1
                      00122                                         ENDW    
                      00123                                         ENDM
                      00124 ;=======================================================================================================
                            =========
                      00125 GOTO_PUNKT_SUBMENU_ACTION       MACRO           ; Макрос, создает переходы на действия всех подпунктов м
                            еню
                      00126                                                         MOD_PCL INDEX_MENU                              
                      00127                                                         LOCAL   C=1
                      00128                                                         WHILE   C<NUM_OF_MAIN_MENU_PUNKTS+1
                      00129                                                                 GOTO    MENU_#V(C)_TABLE_ACTION
                      00130                                                                 C+=1
                      00131                                                         ENDW
                      00132                                                         LOCAL   D=1
                      00133                                                         LOCAL   A
                      00134                                                         WHILE           D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00135                                                                 A=1     
                      00136                                                                 MENU_#V(D)_TABLE_ACTION
                      00137                                                                 MOD_PCL INDEX_SUBMENU
                      00138                                                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00139                                                                         GOTO    MENU_#V(D)_SUBMENU_#V(A)
                            _ACTION
                      00140                                                                         A+=1
                      00141                                                                 ENDW
                      00142                                                                 D+=1
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00143                                                         ENDW
                      00144                                                         ENDM
                      00145 ;=======================================================================================================
                            =========
                      00146 CREATE_SUBMENU_NAMES    MACRO                           ; Макрос, создает имена всех подпунктов меню
                      00147 ; К сожаления, почему-то не получилось создавать имена всех подпунктов меню в цикле, поэтому приходится 
                            вызывать макрос столько раз, сколько есть пунктов меню
                      00148 ; Внимание, если количество пунктов в меню превышает 8, просто добавьте еще
                      00149                                                 LOCAL   D=1
                      00150 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00151 ; Подпункты 1 пункта меню
                      00152 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00153                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00154                                                         LOCAL   A=1     
                      00155                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00156                                                                 MENU_#V(D)_SUBMENU_#V(A)
                      00157                                                                 MOD_PCL SYMBOL_POINTER
                      00158                                                                 DT              MENU_SUBMENU_NAME_1_#V(A
                            ),0
                      00159                                                                 A+=1
                      00160                                                         ENDW
                      00161                                                         D+=1
                      00162                                                 ENDIF
                      00163 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00164 ; Подпункты 2 пункта меню
                      00165 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00166                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00167                                                         LOCAL   A=1     
                      00168                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00169                                                                 MENU_#V(D)_SUBMENU_#V(A)
                      00170                                                                 MOD_PCL SYMBOL_POINTER
                      00171                                                                 DT              MENU_SUBMENU_NAME_2_#V(A
                            ),0
                      00172                                                                 A+=1
                      00173                                                         ENDW
                      00174                                                         D+=1
                      00175                                                 ENDIF
                      00176 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00177 ; Подпункты 3 пункта меню
                      00178 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00179                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00180                                                         LOCAL   A=1     
                      00181                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00182                                                                 MENU_#V(D)_SUBMENU_#V(A)
                      00183                                                                 MOD_PCL SYMBOL_POINTER
                      00184                                                                 DT              MENU_SUBMENU_NAME_3_#V(A
                            ),0
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00185                                                                 A+=1
                      00186                                                         ENDW
                      00187                                                         D+=1
                      00188                                                 ENDIF
                      00189 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00190 ; Подпункты 4 пункта меню
                      00191 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00192                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00193                                                         LOCAL   A=1     
                      00194                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00195                                                                 MENU_#V(D)_SUBMENU_#V(A)
                      00196                                                                 MOD_PCL SYMBOL_POINTER
                      00197                                                                 DT              MENU_SUBMENU_NAME_4_#V(A
                            ),0
                      00198                                                                 A+=1
                      00199                                                         ENDW
                      00200                                                         D+=1
                      00201                                                 ENDIF
                      00202 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00203 ; Подпункты 5 пункта меню
                      00204 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00205                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00206                                                         LOCAL   A=1     
                      00207                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00208                                                                 MENU_#V(D)_SUBMENU_#V(A)
                      00209                                                                 MOD_PCL SYMBOL_POINTER
                      00210                                                                 DT              MENU_SUBMENU_NAME_5_#V(A
                            ),0
                      00211                                                                 A+=1
                      00212                                                         ENDW
                      00213                                                         D+=1
                      00214                                                 ENDIF
                      00215 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00216 ; Подпункты 6 пункта меню
                      00217 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00218                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00219                                                         LOCAL   A=1     
                      00220                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00221                                                                 MENU_#V(D)_SUBMENU_#V(A)
                      00222                                                                 MOD_PCL SYMBOL_POINTER
                      00223                                                                 DT              MENU_SUBMENU_NAME_5_#V(A
                            ),0
                      00224                                                                 A+=1
                      00225                                                         ENDW
                      00226                                                         D+=1
                      00227                                                 ENDIF
                      00228 ;-------------------------------------------------------------------------------------------------------
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            ----
                      00229 ; Подпункты 7 пункта меню
                      00230 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00231                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00232                                                         LOCAL   A=1     
                      00233                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00234                                                                 MENU_#V(D)_SUBMENU_#V(A)
                      00235                                                                 MOD_PCL SYMBOL_POINTER
                      00236                                                                 DT              MENU_SUBMENU_NAME_5_#V(A
                            ),0
                      00237                                                                 A+=1
                      00238                                                         ENDW
                      00239                                                         D+=1
                      00240                                                 ENDIF
                      00241 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00242 ; Подпункты 8 пункта меню
                      00243 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00244                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                      00245                                                         LOCAL   A=1     
                      00246                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_#V(D)+1
                      00247                                                                 MENU_#V(D)_SUBMENU_#V(A)
                      00248                                                                 MOD_PCL SYMBOL_POINTER
                      00249                                                                 DT              MENU_SUBMENU_NAME_5_#V(A
                            ),0
                      00250                                                                 A+=1
                      00251                                                         ENDW
                      00252                                                         D+=1
                      00253                                                 ENDIF
                      00254 ;-------------------------------------------------------------------------------------------------------
                            ----
                      00255                                                 ENDM
                      00256 ;=======================================================================================================
                            =========
Warning[205]: Found directive in column 1. (IF)
                      00257 IF      USE_MENU_ACTION 
                      00258 GOTO_MENU_ACTION        MACRO           ; Макрос, создает переходы на действия всех пунктов меню (если в
                            ключена соответствующая опция)
                      00259                                         MOD_PCL INDEX_MENU                              
                      00260                                         LOCAL   A=1
                      00261                                         WHILE   A<NUM_OF_MAIN_MENU_PUNKTS+1
                      00262                                                 GOTO    MENU_0_ACTION
                      00263                                                 A+=1
                      00264                                         ENDW
                      00265                                         ENDM
                      00266 ENDIF
                      00267 ;=======================================================================================================
                            =========
                      00268 DRAW_KURSOR     MACRO   LAST_SYMBOL
                      00269                         MOVLW   LAST_SYMBOL
                      00270                         CALL    DRAW_KURSOR_ROUTINE
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00271                         ENDM
                      00272                                                 
                      00002         INCLUDE HD44780_LIB.H
Warning[205]: Found directive in column 1. (INCLUDE)
                      00071 INCLUDE HARDWARE_PROFILE.INC
                      00005         INCLUDE P16F84.INC
                      00413         LIST
                      00414 
                      00415 ;==========================================================================
                      00416 ;  MPASM PIC16F84 processor include
                      00417 ; 
                      00418 ;  (c) Copyright 1999-2013 Microchip Technology, All rights reserved
                      00419 ;==========================================================================
                      00420 
Message[310]: Superseding current maximum RAM and RAM map.
                      00618         LIST
                      00006         LIST P=16F84
                      00072 
  00000001            00073 Y                               EQU             1                               ; YES
  00000000            00074 N                               EQU             0                               ; NO
                      00075 
  00000001            00076 USE_4_BIT_MODE  EQU             Y                               ; YES/NO
  00000000            00077 USE_HIGH_NIBLE  EQU             N                               ; YES/NO
  00000000            00078 USE_ONE_PORT    EQU             N                               ; YES/NO
  00000001            00079 ONLY_WRITE              EQU             Y                               ; YES/NO
                      00080 
  00000006            00081 LCD_DATA                EQU             PORTB                   ; Описываем порт линий данных
  00000086            00082 LCD_DATA_TRIS   EQU             TRISB
                      00083 
                      00084         IF      (USE_4_BIT_MODE && USE_ONE_PORT); ; Если используем один порт для данных и линий управле
                            ниЯ
                      00085 
                      00086 LCD_CNTL                EQU             LCD_DATA                ; то так и опишем
                      00087 LCD_CNTL_TRIS   EQU             LCD_DATA_TRIS
                      00088 
                      00089         ELSE
                      00090 
  00000005            00091 LCD_CNTL                EQU             PORTA                   ; Иначе зададим любой другой
  00000085            00092 LCD_CNTL_TRIS   EQU             TRISA
                      00093         ENDIF
                      00094         
                      00095         IF      (USE_4_BIT_MODE && USE_ONE_PORT && USE_HIGH_NIBLE && ONLY_WRITE)
                      00096 E                               EQU             2
                      00097 RS                              EQU             3
                      00098 CNTL_TRIS_MASK  EQU             B'11110011'             ; Маска настройки линий управлениЯ
                      00099         ENDIF
                      00100 
                      00101         IF      (USE_4_BIT_MODE && USE_ONE_PORT && USE_HIGH_NIBLE && !ONLY_WRITE)
                      00102 E                               EQU             1
                      00103 RW                              EQU             2
                      00104 RS                              EQU             3
                      00105 CNTL_TRIS_MASK  EQU             B'11110001'             ; Маска настройки линий управлениЯ
                      00106         ENDIF   
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00107 
                      00108         IF      (USE_4_BIT_MODE && USE_ONE_PORT && !USE_HIGH_NIBLE && ONLY_WRITE)
                      00109 E                               EQU             4
                      00110 RS                              EQU             5
                      00111 CNTL_TRIS_MASK  EQU             B'11001111'             ; Маска настройки линий управлениЯ
                      00112         ENDIF   
                      00113 
                      00114         IF      (USE_4_BIT_MODE && USE_ONE_PORT && !USE_HIGH_NIBLE && !ONLY_WRITE)
                      00115 E                               EQU             4
                      00116 RW                              EQU             5
                      00117 RS                              EQU             6
                      00118 CNTL_TRIS_MASK  EQU             B'10001111'             ; Маска настройки линий управлениЯ
                      00119 
                      00120         ELSE    ; Иначе присваиваем контрольным линиям любой другой порт и вибираем линии их по своему у
                            смотрению
                      00121         
  00000001            00122 E                               EQU             1
  00000003            00123 RS                              EQU             3
  000000F5            00124 CNTL_TRIS_MASK  EQU             B'11110101'             ; Маска настройки линий управления
                      00125         ENDIF
                      00126 
  0000000C            00127 DISP_ON                 EQU             B'00001100'             ; Display on
  0000000E            00128 DISP_ON_C               EQU             B'00001110'             ; Display on, Cursor on
  0000000F            00129 DISP_ON_B               EQU             B'00001111'             ; Display on, Cursor on, Blink cursor
  00000008            00130 DISP_OFF                EQU             B'00001000'             ; Display off
  00000001            00131 CLR_DISP                EQU             B'00000001'             ; Clear the Display
  00000006            00132 ENTRY_INC               EQU             B'00000110'             ; автоинкремент адреса, нет сдвига 
  00000007            00133 ENTRY_INC_S             EQU             B'00000111'             ; автоинкремент адреса, есть сдвиг
  00000004            00134 ENTRY_DEC               EQU             B'00000100'             ; автоинкремент адреса, нет сдвига 
  00000005            00135 ENTRY_DEC_S             EQU             B'00000101'             ;
  00000080            00136 DD_RAM_ADDR             EQU             B'10000000'             ; Least Significant 7-bit are for addres
                            s
  00000080            00137 DD_RAM_UL               EQU             B'10000000'             ; Upper Left coner of the Display
  000000C0            00138 SECOND_LINE             EQU             B'11000000'             ; Move cursor to second line
  0000008F            00139 LAST_SYMBOL_FIRST_LINE  EQU     B'10001111'     ; Установим курсор на последний символ 1-й строки
  000000CF            00140 LAST_SYMBOL_SECOND_LINE EQU     B'11001111'     ; Установим курсор на последний символ 2-й строки       
                                                            
                      00003 
                      00004 MICROMENU_LIB_UDATA     UDATA_SHR
0000                  00005 INDEX_MENU              RES     1
0001                  00006 INDEX_SUBMENU   RES     1
0002                  00007 SYMBOL_POINTER  RES     1
0003                  00008 MENU_COUNTER    RES     1
0004                  00009 TEMP_1                  RES     1
0005                  00010 TEMP_2                  RES     1
0006                  00011 TEMP_3                  RES     1
                      00012 ;num_of_submenu res     1
                      00013 
Warning[205]: Found directive in column 1. (EXTERN)
  0000                00014 EXTERN  FLAGS,OFFSET
                      00015 
                      00016         IF      USE_SHORT_MOD_PCL                               ; Если используется "укороченная" версия
                             макроса модификации PCL
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Warning[205]: Found directive in column 1. (EXTERN)
  0000                00017 EXTERN  KNOWN_ZERO
                      00018         ENDIF
                      00019 
  0000                00020         GLOBAL  MENU_HEANDLER,ZASTAVKA
  0000                00021         EXTERN  SEND_LCD_SYMBOL,SEND_LCD_COMMAND,DELAY_4MS,MAIN
                      00022 ;===================================================================================================
                      00023 MICROMENU               CODE                                    ; Сегмент кода библиотеки меню
                      00024 ;===================================================================================================
0000                  00025 TABLE_ACTION_COMPLETE 
                      00026         MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
0000   08??               M                 MOVFW   SYMBOL_POINTER
0001   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0002   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
0003   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
0004   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
0005   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
0006   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
0007   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
0008                      M         TABLE
0008   3441 3463 3474 00027         DT              ACTION_COMPLETE_STRING,0
       3469 346F 346E 
       3420 3443 346F 
       346D 3470 346C 
       3465 3474 3465 
       3421 3400 
                      00028 
0019                  00029 TABLE_ZASTAVKA_FIRST_STRING
                      00030         MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
0019   08??               M                 MOVFW   SYMBOL_POINTER
001A   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
001B   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
001C   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
001D   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
001E   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
001F   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
0020   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0021                      M         TABLE
0021   3420 3420 344D 00031         DT              ZASTAVKA_FIRST_STRING,0
       3469 3463 3472 
       346F 344D 3465 
       346E 3475 344C 
       3469 3462 3400 
                      00032 
0030                  00033 TABLE_ZASTAVKA_SECOND_STRING 
                      00034         MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
0030   08??               M                 MOVFW   SYMBOL_POINTER
0031   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0032   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
0033   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
0034   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
0035   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
0036   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
0037   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
0038                      M         TABLE
0038   3420 3420 3476 00035         DT              ZASTAVKA_SECOND_STRING,0
       3465 3472 3420 
       3431 342E 3430 
       3420 3462 3465 
       3474 3461 3400 
                      00036 ;===================================================================================================
0047                  00037 NUM_OF_SUBMENU_TABLE                                    
                      00038         RETLW_NUM_OF_SUBMENU_PUNKTS                     ; Макрос, возвращает количество подпунктов текущ
                            его пункта меню
                          M                                                         MOD_PCL INDEX_MENU
  0000                    M                 LOCAL   TABLE
0047   08??               M                 MOVFW   INDEX_MENU
0048   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0049   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
004A   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
004B   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
004C   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
004D   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
004E   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
004F                      M         TABLE
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  0001                    M                                                         LOCAL   A=1
                          M                                                         WHILE   A<NUM_OF_MAIN_MENU_PUNKTS+1
004F   3400               M                                                                 RETLW   NUM_OF_SUBMENU_PUNKTS_1
Warning[207]: Found label after column 1. (A)
  00000002                M                                                                 A+=1
0050   3401               M                                                                 RETLW   NUM_OF_SUBMENU_PUNKTS_2
Warning[207]: Found label after column 1. (A)
  00000003                M                                                                 A+=1
0051   3402               M                                                                 RETLW   NUM_OF_SUBMENU_PUNKTS_3
Warning[207]: Found label after column 1. (A)
  00000004                M                                                                 A+=1
0052   3403               M                                                                 RETLW   NUM_OF_SUBMENU_PUNKTS_4
Warning[207]: Found label after column 1. (A)
  00000005                M                                                                 A+=1
0053   3403               M                                                                 RETLW   NUM_OF_SUBMENU_PUNKTS_5
Warning[207]: Found label after column 1. (A)
  00000006                M                                                                 A+=1
                          M                                                         ENDW
                      00039 ;===================================================================================================
0054                  00040 SWITCH_MENU_TABLE                                               ; Переходим на нужный пункт меню
                      00041         GOTO_PUNKT_MENU                                         ; Макрос, создает переходы на все пункты
                             меню                                           
                          M                                 MOD_PCL INDEX_MENU
  0000                    M                 LOCAL   TABLE
0054   08??               M                 MOVFW   INDEX_MENU
0055   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0056   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
0057   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
0058   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
0059   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
005A   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
005B   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
005C                      M         TABLE
  0001                    M                                 LOCAL   A=1
                          M                                 WHILE   A<NUM_OF_MAIN_MENU_PUNKTS+1
005C   2???               M                                         GOTO    MENU_1
Warning[207]: Found label after column 1. (A)
  00000002                M                                         A+=1
005D   2???               M                                         GOTO    MENU_2
Warning[207]: Found label after column 1. (A)
  00000003                M                                         A+=1
005E   2???               M                                         GOTO    MENU_3
Warning[207]: Found label after column 1. (A)
  00000004                M                                         A+=1
005F   2???               M                                         GOTO    MENU_4
Warning[207]: Found label after column 1. (A)
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000005                M                                         A+=1
0060   2???               M                                         GOTO    MENU_5
Warning[207]: Found label after column 1. (A)
  00000006                M                                         A+=1
                          M                                 ENDW
                      00042 ;---------------------------------------------------------------------------------------------------
0061                  00043 SWITCH_SUBMENU_TABLE                                    ; Переходим на нужный подпункт меню
                      00044         GOTO_PUNKT_SUBMENU                                      ; Макрос, создает переходы на все подпун
                            кты меню
                          M                                         MOD_PCL INDEX_MENU                              
  0000                    M                 LOCAL   TABLE
0061   08??               M                 MOVFW   INDEX_MENU
0062   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0063   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
0064   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
0065   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
0066   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
0067   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
0068   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
0069                      M         TABLE
  0001                    M                                         LOCAL   C=1
                          M                                         WHILE   C<NUM_OF_MAIN_MENU_PUNKTS+1
0069   2???               M                                                 GOTO    MENU_1_TABLE
Warning[207]: Found label after column 1. (C)
  00000002                M                                                 C+=1
006A   2???               M                                                 GOTO    MENU_2_TABLE
Warning[207]: Found label after column 1. (C)
  00000003                M                                                 C+=1
006B   2???               M                                                 GOTO    MENU_3_TABLE
Warning[207]: Found label after column 1. (C)
  00000004                M                                                 C+=1
006C   2???               M                                                 GOTO    MENU_4_TABLE
Warning[207]: Found label after column 1. (C)
  00000005                M                                                 C+=1
006D   2???               M                                                 GOTO    MENU_5_TABLE
Warning[207]: Found label after column 1. (C)
  00000006                M                                                 C+=1
                          M                                         ENDW
  0001                    M                                         LOCAL   D=1
  0000                    M                                         LOCAL   A
                          M                                         WHILE           D<NUM_OF_MAIN_MENU_PUNKTS+1
Warning[207]: Found label after column 1. (A)
  00000001                M                                                 A=1     
Warning[207]: Found label after column 1. (MENU_1_TABLE)
006E                      M                                                 MENU_1_TABLE
                          M                                                 MOD_PCL INDEX_SUBMENU
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  0000                    M                 LOCAL   TABLE
006E   08??               M                 MOVFW   INDEX_SUBMENU
006F   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0070   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
0071   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
0072   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
0073   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
0074   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
0075   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
0076                      M         TABLE
                          M                                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_1+1
                          M                                                         GOTO    MENU_#V(D)_SUBMENU_#V(A)
                          M                                                         A+=1
                          M                                                 ENDW
Warning[207]: Found label after column 1. (D)
  00000002                M                                                 D+=1
Warning[207]: Found label after column 1. (A)
  00000001                M                                                 A=1     
Warning[207]: Found label after column 1. (MENU_2_TABLE)
0076                      M                                                 MENU_2_TABLE
                          M                                                 MOD_PCL INDEX_SUBMENU
  0000                    M                 LOCAL   TABLE
0076   08??               M                 MOVFW   INDEX_SUBMENU
0077   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0078   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
0079   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
007A   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
007B   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
007C   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
007D   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
007E                      M         TABLE
                          M                                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_2+1
007E   2???               M                                                         GOTO    MENU_2_SUBMENU_1
Warning[207]: Found label after column 1. (A)
  00000002                M                                                         A+=1
                          M                                                 ENDW
Warning[207]: Found label after column 1. (D)
  00000003                M                                                 D+=1
Warning[207]: Found label after column 1. (A)
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000001                M                                                 A=1     
Warning[207]: Found label after column 1. (MENU_3_TABLE)
007F                      M                                                 MENU_3_TABLE
                          M                                                 MOD_PCL INDEX_SUBMENU
  0000                    M                 LOCAL   TABLE
007F   08??               M                 MOVFW   INDEX_SUBMENU
0080   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0081   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
0082   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
0083   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
0084   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
0085   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
0086   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
0087                      M         TABLE
                          M                                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_3+1
0087   2???               M                                                         GOTO    MENU_3_SUBMENU_1
Warning[207]: Found label after column 1. (A)
  00000002                M                                                         A+=1
0088   2???               M                                                         GOTO    MENU_3_SUBMENU_2
Warning[207]: Found label after column 1. (A)
  00000003                M                                                         A+=1
                          M                                                 ENDW
Warning[207]: Found label after column 1. (D)
  00000004                M                                                 D+=1
Warning[207]: Found label after column 1. (A)
  00000001                M                                                 A=1     
Warning[207]: Found label after column 1. (MENU_4_TABLE)
0089                      M                                                 MENU_4_TABLE
                          M                                                 MOD_PCL INDEX_SUBMENU
  0000                    M                 LOCAL   TABLE
0089   08??               M                 MOVFW   INDEX_SUBMENU
008A   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
008B   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
008C   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
008D   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
008E   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
008F   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
0090   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
0091                      M         TABLE
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M                                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_4+1
0091   2???               M                                                         GOTO    MENU_4_SUBMENU_1
Warning[207]: Found label after column 1. (A)
  00000002                M                                                         A+=1
0092   2???               M                                                         GOTO    MENU_4_SUBMENU_2
Warning[207]: Found label after column 1. (A)
  00000003                M                                                         A+=1
0093   2???               M                                                         GOTO    MENU_4_SUBMENU_3
Warning[207]: Found label after column 1. (A)
  00000004                M                                                         A+=1
                          M                                                 ENDW
Warning[207]: Found label after column 1. (D)
  00000005                M                                                 D+=1
Warning[207]: Found label after column 1. (A)
  00000001                M                                                 A=1     
Warning[207]: Found label after column 1. (MENU_5_TABLE)
0094                      M                                                 MENU_5_TABLE
                          M                                                 MOD_PCL INDEX_SUBMENU
  0000                    M                 LOCAL   TABLE
0094   08??               M                 MOVFW   INDEX_SUBMENU
0095   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0096   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
0097   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
0098   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
0099   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
009A   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
009B   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
009C                      M         TABLE
                          M                                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_5+1
009C   2???               M                                                         GOTO    MENU_5_SUBMENU_1
Warning[207]: Found label after column 1. (A)
  00000002                M                                                         A+=1
009D   2???               M                                                         GOTO    MENU_5_SUBMENU_2
Warning[207]: Found label after column 1. (A)
  00000003                M                                                         A+=1
009E   2???               M                                                         GOTO    MENU_5_SUBMENU_3
Warning[207]: Found label after column 1. (A)
  00000004                M                                                         A+=1
                          M                                                 ENDW
Warning[207]: Found label after column 1. (D)
  00000006                M                                                 D+=1
                          M                                         ENDW    
                      00045 ;---------------------------------------------------------------------------------------------------
009F                  00046 SWITCH_ACTION                                                   ; Выполним действие, на котором находитс
                            я курсор 
                      00047         GOTO_PUNKT_SUBMENU_ACTION                       ; Макрос, создает переходы на действия всех подп
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            унктов меню
                          M                                                         MOD_PCL INDEX_MENU                              
  0000                    M                 LOCAL   TABLE
009F   08??               M                 MOVFW   INDEX_MENU
00A0   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
00A1   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
00A2   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
00A3   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
00A4   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
00A5   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
00A6   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
00A7                      M         TABLE
  0001                    M                                                         LOCAL   C=1
                          M                                                         WHILE   C<NUM_OF_MAIN_MENU_PUNKTS+1
00A7   2???               M                                                                 GOTO    MENU_1_TABLE_ACTION
Warning[207]: Found label after column 1. (C)
  00000002                M                                                                 C+=1
00A8   2???               M                                                                 GOTO    MENU_2_TABLE_ACTION
Warning[207]: Found label after column 1. (C)
  00000003                M                                                                 C+=1
00A9   2???               M                                                                 GOTO    MENU_3_TABLE_ACTION
Warning[207]: Found label after column 1. (C)
  00000004                M                                                                 C+=1
00AA   2???               M                                                                 GOTO    MENU_4_TABLE_ACTION
Warning[207]: Found label after column 1. (C)
  00000005                M                                                                 C+=1
00AB   2???               M                                                                 GOTO    MENU_5_TABLE_ACTION
Warning[207]: Found label after column 1. (C)
  00000006                M                                                                 C+=1
                          M                                                         ENDW
  0001                    M                                                         LOCAL   D=1
  0000                    M                                                         LOCAL   A
                          M                                                         WHILE           D<NUM_OF_MAIN_MENU_PUNKTS+1
Warning[207]: Found label after column 1. (A)
  00000001                M                                                                 A=1     
Warning[207]: Found label after column 1. (MENU_1_TABLE_ACTION)
00AC                      M                                                                 MENU_1_TABLE_ACTION
                          M                                                                 MOD_PCL INDEX_SUBMENU
  0000                    M                 LOCAL   TABLE
00AC   08??               M                 MOVFW   INDEX_SUBMENU
00AD   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
00AE   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
00AF   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
00B0   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
00B1   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
00B2   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
00B3   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
00B4                      M         TABLE
                          M                                                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_1+1
                          M                                                                         GOTO    MENU_#V(D)_SUBMENU_#V(A)
                            _ACTION
                          M                                                                         A+=1
                          M                                                                 ENDW
Warning[207]: Found label after column 1. (D)
  00000002                M                                                                 D+=1
Warning[207]: Found label after column 1. (A)
  00000001                M                                                                 A=1     
Warning[207]: Found label after column 1. (MENU_2_TABLE_ACTION)
00B4                      M                                                                 MENU_2_TABLE_ACTION
                          M                                                                 MOD_PCL INDEX_SUBMENU
  0000                    M                 LOCAL   TABLE
00B4   08??               M                 MOVFW   INDEX_SUBMENU
00B5   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
00B6   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
00B7   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
00B8   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
00B9   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
00BA   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
00BB   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
00BC                      M         TABLE
                          M                                                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_2+1
00BC   2???               M                                                                         GOTO    MENU_2_SUBMENU_1_ACTION
Warning[207]: Found label after column 1. (A)
  00000002                M                                                                         A+=1
                          M                                                                 ENDW
Warning[207]: Found label after column 1. (D)
  00000003                M                                                                 D+=1
Warning[207]: Found label after column 1. (A)
  00000001                M                                                                 A=1     
Warning[207]: Found label after column 1. (MENU_3_TABLE_ACTION)
00BD                      M                                                                 MENU_3_TABLE_ACTION
                          M                                                                 MOD_PCL INDEX_SUBMENU
  0000                    M                 LOCAL   TABLE
00BD   08??               M                 MOVFW   INDEX_SUBMENU
00BE   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00BF   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
00C0   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
00C1   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
00C2   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
00C3   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
00C4   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
00C5                      M         TABLE
                          M                                                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_3+1
00C5   2???               M                                                                         GOTO    MENU_3_SUBMENU_1_ACTION
Warning[207]: Found label after column 1. (A)
  00000002                M                                                                         A+=1
00C6   2???               M                                                                         GOTO    MENU_3_SUBMENU_2_ACTION
Warning[207]: Found label after column 1. (A)
  00000003                M                                                                         A+=1
                          M                                                                 ENDW
Warning[207]: Found label after column 1. (D)
  00000004                M                                                                 D+=1
Warning[207]: Found label after column 1. (A)
  00000001                M                                                                 A=1     
Warning[207]: Found label after column 1. (MENU_4_TABLE_ACTION)
00C7                      M                                                                 MENU_4_TABLE_ACTION
                          M                                                                 MOD_PCL INDEX_SUBMENU
  0000                    M                 LOCAL   TABLE
00C7   08??               M                 MOVFW   INDEX_SUBMENU
00C8   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
00C9   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
00CA   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
00CB   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
00CC   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
00CD   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
00CE   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
00CF                      M         TABLE
                          M                                                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_4+1
00CF   2???               M                                                                         GOTO    MENU_4_SUBMENU_1_ACTION
Warning[207]: Found label after column 1. (A)
  00000002                M                                                                         A+=1
00D0   2???               M                                                                         GOTO    MENU_4_SUBMENU_2_ACTION
Warning[207]: Found label after column 1. (A)
  00000003                M                                                                         A+=1
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00D1   2???               M                                                                         GOTO    MENU_4_SUBMENU_3_ACTION
Warning[207]: Found label after column 1. (A)
  00000004                M                                                                         A+=1
                          M                                                                 ENDW
Warning[207]: Found label after column 1. (D)
  00000005                M                                                                 D+=1
Warning[207]: Found label after column 1. (A)
  00000001                M                                                                 A=1     
Warning[207]: Found label after column 1. (MENU_5_TABLE_ACTION)
00D2                      M                                                                 MENU_5_TABLE_ACTION
                          M                                                                 MOD_PCL INDEX_SUBMENU
  0000                    M                 LOCAL   TABLE
00D2   08??               M                 MOVFW   INDEX_SUBMENU
00D3   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
00D4   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
00D5   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
00D6   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
00D7   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
00D8   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
00D9   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
00DA                      M         TABLE
                          M                                                                 WHILE   A<NUM_OF_SUBMENU_PUNKTS_5+1
00DA   2???               M                                                                         GOTO    MENU_5_SUBMENU_1_ACTION
Warning[207]: Found label after column 1. (A)
  00000002                M                                                                         A+=1
00DB   2???               M                                                                         GOTO    MENU_5_SUBMENU_2_ACTION
Warning[207]: Found label after column 1. (A)
  00000003                M                                                                         A+=1
00DC   2???               M                                                                         GOTO    MENU_5_SUBMENU_3_ACTION
Warning[207]: Found label after column 1. (A)
  00000004                M                                                                         A+=1
                          M                                                                 ENDW
Warning[207]: Found label after column 1. (D)
  00000006                M                                                                 D+=1
                          M                                                         ENDW
                      00048 ;===================================================================================================
                      00049         CREATE_MENU_NAMES                                       ; Макрос, создает имена всех пунктов мен
                            ю
  0001                    M                                         LOCAL   A=1
                          M                                         WHILE   A<NUM_OF_MAIN_MENU_PUNKTS+1
Warning[207]: Found label after column 1. (MENU_1)
00DD                      M                                                 MENU_1
                          M                                                 MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
00DD   08??               M                 MOVFW   SYMBOL_POINTER
00DE   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00DF   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
00E0   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
00E1   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
00E2   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
00E3   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
00E4   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
00E5                      M         TABLE
00E5   3431 342E 344D     M                                                 DT              MENU_NAME_1,0
       3465 346E 3475 
       345F 3431 3400 
Warning[207]: Found label after column 1. (A)
  00000002                M                                                 A+=1
Warning[207]: Found label after column 1. (MENU_2)
00EE                      M                                                 MENU_2
                          M                                                 MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
00EE   08??               M                 MOVFW   SYMBOL_POINTER
00EF   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
00F0   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
00F1   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
00F2   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
00F3   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
00F4   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
00F5   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
00F6                      M         TABLE
00F6   3432 342E 344D     M                                                 DT              MENU_NAME_2,0
       3465 346E 3475 
       345F 3432 3400 
Warning[207]: Found label after column 1. (A)
  00000003                M                                                 A+=1
Warning[207]: Found label after column 1. (MENU_3)
00FF                      M                                                 MENU_3
                          M                                                 MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
00FF   08??               M                 MOVFW   SYMBOL_POINTER
0100   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0101   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
0102   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0103   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
0104   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
0105   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
0106   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
0107                      M         TABLE
0107   3433 342E 344D     M                                                 DT              MENU_NAME_3,0
       3465 346E 3475 
       345F 3433 3400 
Warning[207]: Found label after column 1. (A)
  00000004                M                                                 A+=1
Warning[207]: Found label after column 1. (MENU_4)
0110                      M                                                 MENU_4
                          M                                                 MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
0110   08??               M                 MOVFW   SYMBOL_POINTER
0111   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0112   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
0113   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
0114   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
0115   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
0116   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
0117   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
0118                      M         TABLE
0118   3434 342E 344D     M                                                 DT              MENU_NAME_4,0
       3465 346E 3475 
       345F 3434 3400 
Warning[207]: Found label after column 1. (A)
  00000005                M                                                 A+=1
Warning[207]: Found label after column 1. (MENU_5)
0121                      M                                                 MENU_5
                          M                                                 MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
0121   08??               M                 MOVFW   SYMBOL_POINTER
0122   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0123   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
0124   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
0125   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
0126   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
0127   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
0128   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
0129                      M         TABLE
0129   3435 342E 344D     M                                                 DT              MENU_NAME_5,0
       3465 346E 3475 
       345F 3435 3400 
Warning[207]: Found label after column 1. (A)
  00000006                M                                                 A+=1
                          M                                         ENDW
                      00050 ;===================================================================================================
                      00051         CREATE_SUBMENU_NAMES                            ; Макрос, создает имена всех подпунктов меню
                          M ; К сожаления, почему-то не получилось создавать имена всех подпунктов меню в цикле, поэтому приходится 
                            вызывать макрос столько раз, сколько есть пунктов меню
                          M ; Внимание, если количество пунктов в меню превышает 8, просто добавьте еще
  0001                    M                                                 LOCAL   D=1
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M ; Подпункты 1 пункта меню
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
  0001                    M                                                         LOCAL   A=1     
                          M                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_1+1
                          M                                                                 MENU_#V(D)_SUBMENU_#V(A)
                          M                                                                 MOD_PCL SYMBOL_POINTER
                          M                                                                 DT              MENU_SUBMENU_NAME_1_#V(A
                            ),0
                          M                                                                 A+=1
                          M                                                         ENDW
Warning[207]: Found label after column 1. (D)
  00000002                M                                                         D+=1
                          M                                                 ENDIF
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M ; Подпункты 2 пункта меню
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
  0001                    M                                                         LOCAL   A=1     
                          M                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_2+1
Warning[207]: Found label after column 1. (MENU_2_SUBMENU_1)
0132                      M                                                                 MENU_2_SUBMENU_1
                          M                                                                 MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
0132   08??               M                 MOVFW   SYMBOL_POINTER
0133   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0134   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0135   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
0136   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
0137   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
0138   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
0139   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
013A                      M         TABLE
013A   3432 342E 3431     M                                                                 DT              MENU_SUBMENU_NAME_2_1,0
       342E 3453 3475 
       3462 344D 3465 
       346E 3475 3400 
Warning[207]: Found label after column 1. (A)
  00000002                M                                                                 A+=1
                          M                                                         ENDW
Warning[207]: Found label after column 1. (D)
  00000003                M                                                         D+=1
                          M                                                 ENDIF
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M ; Подпункты 3 пункта меню
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
  0001                    M                                                         LOCAL   A=1     
                          M                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_3+1
Warning[207]: Found label after column 1. (MENU_3_SUBMENU_1)
0146                      M                                                                 MENU_3_SUBMENU_1
                          M                                                                 MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
0146   08??               M                 MOVFW   SYMBOL_POINTER
0147   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0148   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
0149   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
014A   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
014B   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
014C   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
014D   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
014E                      M         TABLE
014E   3433 342E 3431     M                                                                 DT              MENU_SUBMENU_NAME_3_1,0
       342E 3453 3475 
       3462 344D 3465 
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

       346E 3475 3400 
Warning[207]: Found label after column 1. (A)
  00000002                M                                                                 A+=1
Warning[207]: Found label after column 1. (MENU_3_SUBMENU_2)
015A                      M                                                                 MENU_3_SUBMENU_2
                          M                                                                 MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
015A   08??               M                 MOVFW   SYMBOL_POINTER
015B   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
015C   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
015D   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
015E   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
015F   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
0160   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
0161   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
0162                      M         TABLE
0162   3433 342E 3432     M                                                                 DT              MENU_SUBMENU_NAME_3_2,0
       342E 3453 3475 
       3462 344D 3465 
       346E 3475 3400 
Warning[207]: Found label after column 1. (A)
  00000003                M                                                                 A+=1
                          M                                                         ENDW
Warning[207]: Found label after column 1. (D)
  00000004                M                                                         D+=1
                          M                                                 ENDIF
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M ; Подпункты 4 пункта меню
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
  0001                    M                                                         LOCAL   A=1     
                          M                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_4+1
Warning[207]: Found label after column 1. (MENU_4_SUBMENU_1)
016E                      M                                                                 MENU_4_SUBMENU_1
                          M                                                                 MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
016E   08??               M                 MOVFW   SYMBOL_POINTER
016F   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0170   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
0171   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
0172   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
0173   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
0174   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
0175   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
0176                      M         TABLE
0176   3434 342E 3431     M                                                                 DT              MENU_SUBMENU_NAME_4_1,0
       342E 3453 3475 
       3462 344D 3465 
       346E 3475 3400 
Warning[207]: Found label after column 1. (A)
  00000002                M                                                                 A+=1
Warning[207]: Found label after column 1. (MENU_4_SUBMENU_2)
0182                      M                                                                 MENU_4_SUBMENU_2
                          M                                                                 MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
0182   08??               M                 MOVFW   SYMBOL_POINTER
0183   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0184   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
0185   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
0186   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
0187   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
0188   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
0189   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
018A                      M         TABLE
018A   3434 342E 3432     M                                                                 DT              MENU_SUBMENU_NAME_4_2,0
       342E 3453 3475 
       3462 344D 3465 
       346E 3475 3400 
Warning[207]: Found label after column 1. (A)
  00000003                M                                                                 A+=1
Warning[207]: Found label after column 1. (MENU_4_SUBMENU_3)
0196                      M                                                                 MENU_4_SUBMENU_3
                          M                                                                 MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
0196   08??               M                 MOVFW   SYMBOL_POINTER
0197   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
0198   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
0199   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
019A   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
019B   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
019C   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
019D   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
019E                      M         TABLE
019E   3434 342E 3433     M                                                                 DT              MENU_SUBMENU_NAME_4_3,0
       342E 3453 3475 
       3462 344D 3465 
       346E 3475 3400 
Warning[207]: Found label after column 1. (A)
  00000004                M                                                                 A+=1
                          M                                                         ENDW
Warning[207]: Found label after column 1. (D)
  00000005                M                                                         D+=1
                          M                                                 ENDIF
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M ; Подпункты 5 пункта меню
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
  0001                    M                                                         LOCAL   A=1     
                          M                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_5+1
Warning[207]: Found label after column 1. (MENU_5_SUBMENU_1)
01AA                      M                                                                 MENU_5_SUBMENU_1
                          M                                                                 MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
01AA   08??               M                 MOVFW   SYMBOL_POINTER
01AB   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
01AC   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
01AD   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
01AE   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
01AF   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
01B0   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
01B1   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
01B2                      M         TABLE
01B2   3435 342E 3431     M                                                                 DT              MENU_SUBMENU_NAME_5_1,0
       342E 3453 3475 
       3462 344D 3465 
       346E 3475 3400 
Warning[207]: Found label after column 1. (A)
  00000002                M                                                                 A+=1
Warning[207]: Found label after column 1. (MENU_5_SUBMENU_2)
01BE                      M                                                                 MENU_5_SUBMENU_2
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M                                                                 MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
01BE   08??               M                 MOVFW   SYMBOL_POINTER
01BF   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
01C0   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
01C1   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
01C2   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
01C3   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
01C4   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
01C5   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
01C6                      M         TABLE
01C6   3435 342E 3432     M                                                                 DT              MENU_SUBMENU_NAME_5_2,0
       342E 3453 3475 
       3462 344D 3465 
       346E 3475 3400 
Warning[207]: Found label after column 1. (A)
  00000003                M                                                                 A+=1
Warning[207]: Found label after column 1. (MENU_5_SUBMENU_3)
01D2                      M                                                                 MENU_5_SUBMENU_3
                          M                                                                 MOD_PCL SYMBOL_POINTER
  0000                    M                 LOCAL   TABLE
01D2   08??               M                 MOVFW   SYMBOL_POINTER
01D3   3E??               M                 ADDLW   LOW TABLE               ; Добавить 8 младших бит адреса таблицы к смещению
01D4   00??               M                 MOVWF   OFFSET                  ; Сохранить младшие 8 бит требуемого адреса
                          M         IF      USE_SHORT_MOD_PCL
01D5   0D??               M                 RLF             KNOWN_ZERO,W    ; так сохраняют бит переполнения от сложения 
01D6   3E??               M                 ADDLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M         ELSE
                          M                 MOVLW   HIGH TABLE              ; Загрузить 5 старших бит адреса
                          M                 BTFSC   STATUS,C                ; Перешли границу страницы памяти программ?
                          M                 ADDLW   1                               ; Если да, увеличить на 1 старшие 5 бит
                          M         ENDIF
01D7   008A               M                 MOVWF   PCLATH                  ; Установить старшую часть адреса
01D8   08??               M                 MOVFW   OFFSET                  ; Загрузить рассчитанное значание младшей части адреса
01D9   0082               M                 MOVWF   PCL                             ; Установить младшую часть адреса
Warning[207]: Found label after column 1. (TABLE)
01DA                      M         TABLE
01DA   3435 342E 3433     M                                                                 DT              MENU_SUBMENU_NAME_5_3,0
       342E 3453 3475 
       3462 344D 3465 
       346E 3475 3400 
Warning[207]: Found label after column 1. (A)
  00000004                M                                                                 A+=1
                          M                                                         ENDW
Warning[207]: Found label after column 1. (D)
  00000006                M                                                         D+=1
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M                                                 ENDIF
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M ; Подпункты 6 пункта меню
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                          M                                                         LOCAL   A=1     
                          M                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_6+1
                          M                                                                 MENU_6_SUBMENU_4
                          M                                                                 MOD_PCL SYMBOL_POINTER
                          M                                                                 DT              MENU_SUBMENU_NAME_5_4,0
                          M                                                                 A+=1
                          M                                                         ENDW
                          M                                                         D+=1
                          M                                                 ENDIF
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M ; Подпункты 7 пункта меню
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                          M                                                         LOCAL   A=1     
                          M                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_6+1
                          M                                                                 MENU_6_SUBMENU_4
                          M                                                                 MOD_PCL SYMBOL_POINTER
                          M                                                                 DT              MENU_SUBMENU_NAME_5_4,0
                          M                                                                 A+=1
                          M                                                         ENDW
                          M                                                         D+=1
                          M                                                 ENDIF
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M ; Подпункты 8 пункта меню
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                          M                                                 IF              D<NUM_OF_MAIN_MENU_PUNKTS+1
                          M                                                         LOCAL   A=1     
                          M                                                         WHILE   A<NUM_OF_SUBMENU_PUNKTS_6+1
                          M                                                                 MENU_6_SUBMENU_4
                          M                                                                 MOD_PCL SYMBOL_POINTER
                          M                                                                 DT              MENU_SUBMENU_NAME_5_4,0
                          M                                                                 A+=1
                          M                                                         ENDW
                          M                                                         D+=1
                          M                                                 ENDIF
                          M ;-------------------------------------------------------------------------------------------------------
                            ----
                      00052 ;===================================================================================================
Warning[205]: Found directive in column 1. (IF)
                      00053 IF      USE_MENU_ACTION
                      00054 MENU_ACTION
                      00055         GOTO_MENU_ACTION
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00056 ;===================================================================================================
                      00057 MENU_1_ACTION                                                   ; Выполняем действие 1 пункта меню
                      00058 ;       nop
                      00059         GOTO    END_MENU_ACTION
                      00060 MENU_2_ACTION                                                   ; Выполняем действие 2 пункта меню
                      00061 ;       nop
                      00062         GOTO    END_MENU_ACTION
                      00063 MENU_3_ACTION                                                   ; Выполняем действие 3 пункта меню
                      00064 ;       nop
                      00065         GOTO    END_MENU_ACTION
                      00066 MENU_4_ACTION                                                   ; Выполняем действие 4 пункта меню
                      00067 ;       nop
                      00068         GOTO    END_MENU_ACTION
                      00069 MENU_5_ACTION                                                   ; Выполняем действие 5 пункта меню
                      00070 ;       nop
                      00071         GOTO    END_MENU_ACTION
                      00072 ENDIF
                      00073 ;===================================================================================================
01E6                  00074 MENU_1_SUBMENU_1_ACTION                                 ; Выполняем действие 1 подпункта 1 пункта
                      00075 ;       nop
01E6   2???           00076         GOTO    END_ACTION
01E7                  00077 MENU_1_SUBMENU_2_ACTION                                 ; Выполняем действие 2 подпункта 1 пункта
                      00078 ;       nop
01E7   2???           00079         GOTO    END_ACTION
01E8                  00080 MENU_1_SUBMENU_3_ACTION                                 ; Выполняем действие 3 подпункта 1 пункта
                      00081 ;       nop
01E8   2???           00082         GOTO    END_ACTION
                      00083 ;---------------------------------------------------------------------------------------------------
01E9                  00084 MENU_2_SUBMENU_1_ACTION                                 ; Выполняем действие 1 подпункта 2 пункта
                      00085 ;       nop
01E9   2???           00086         GOTO    END_ACTION
01EA                  00087 MENU_2_SUBMENU_2_ACTION                                 ; Выполняем действие 2 подпункта 2 пункта
                      00088 ;       nop
01EA   2???           00089         GOTO    END_ACTION
01EB                  00090 MENU_2_SUBMENU_3_ACTION                                 ; Выполняем действие 3 подпункта 2 пункта
                      00091 ;       nop
01EB   2???           00092         GOTO    END_ACTION
                      00093 ;---------------------------------------------------------------------------------------------------
01EC                  00094 MENU_3_SUBMENU_1_ACTION                                 ; Выполняем действие 1 подпункта 3 пункта
                      00095 ;       nop
01EC   2???           00096         GOTO    END_ACTION
01ED                  00097 MENU_3_SUBMENU_2_ACTION                                 ; Выполняем действие 2 подпункта 3 пункта
                      00098 ;       nop
01ED   2???           00099         GOTO    END_ACTION
01EE                  00100 MENU_3_SUBMENU_3_ACTION                                 ; Выполняем действие 3 подпункта 3 пункта
                      00101 ;       nop
01EE   2???           00102         GOTO    END_ACTION
                      00103 ;---------------------------------------------------------------------------------------------------
01EF                  00104 MENU_4_SUBMENU_1_ACTION                                 ; Выполняем действие 1 подпункта 4 пункта
                      00105 ;       nop
01EF   2???           00106         GOTO    END_ACTION
01F0                  00107 MENU_4_SUBMENU_2_ACTION                                 ; Выполняем действие 2 подпункта 4 пункта
                      00108 ;       nop
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01F0   2???           00109         GOTO    END_ACTION
01F1                  00110 MENU_4_SUBMENU_3_ACTION                                 ; Выполняем действие 3 подпункта 4 пункта
                      00111 ;       nop
01F1   2???           00112         GOTO    END_ACTION                                                              
                      00113 ;---------------------------------------------------------------------------------------------------
01F2                  00114 MENU_5_SUBMENU_1_ACTION                                 ; Выполняем действие 1 подпункта 5 пункта
                      00115 ;       nop
01F2   2???           00116         GOTO    END_ACTION
01F3                  00117 MENU_5_SUBMENU_2_ACTION                                 ; Выполняем действие 2 подпункта 5 пункта
                      00118 ;       nop
01F3   2???           00119         GOTO    END_ACTION
01F4                  00120 MENU_5_SUBMENU_3_ACTION                                 ; Выполняем действие 3 подпункта 5 пункта
                      00121 ;       nop
01F4   2???           00122         GOTO    END_ACTION                      
                      00123 ;===================================================================================================
01F5                  00124 CLR_DISPLAY_ROUTINE                                             ; Подпрограмма очистки дисплея
01F5   3001           00125         MOVLW   CLR_DISP
01F6   2???           00126         CALL    SEND_LCD_COMMAND
01F7   2???           00127         CALL    DELAY_4MS                                       ; Обязательная задержка после очистки ди
                            сплея !!!
01F8   0008           00128         RETURN
                      00129 ;===================================================================================================
01F9                  00130 SECOND_STRING_ROUTINE                                   ; Подпрограмма перевода указателя на 2-ю строку 
Warning[205]: Found directive in column 1. (IF)
                      00131 IF      USE_STATIC_CURSOR
                      00132         DRAW_KURSOR     LAST_SYMBOL_FIRST_LINE  ; Сперва нарисум курсор в конце 1-й строчки
                      00133 ENDIF
01F9   30C0           00134         MOVLW   SECOND_LINE                                     ; Переводим указатель на 2-ю строку     
01FA   2???           00135         CALL    SEND_LCD_COMMAND
01FB   0008           00136         RETURN                                                          ; И приступаем к отрисовке следу
                            ющего пункта меню
                      00137 ;===================================================================================================
01FC                  00138 SWITCH_MENU_ROUTINE                                             ; Подпрограмма вывода названия пункта ме
                            ню на дисплей
01FC   01??           00139         CLRF    SYMBOL_POINTER
01FD                  00140 STRING_MENU
01FD   2???           00141         CALL    SWITCH_MENU_TABLE
01FE   39FF           00142         ANDLW   0FFH
01FF   1903           00143         BTFSC   STATUS,Z
0200   0008           00144         RETURN 
0201   2???           00145         CALL    SEND_LCD_SYMBOL
Message[305]: Using default destination of 1 (file).
0202   0A??           00146         INCF    SYMBOL_POINTER  
0203   2???           00147         GOTO    STRING_MENU
                      00148 ;-------------------------------------------------------------------------------------------------------
                            ---------------------
0204                  00149 SWITCH_SUBMENU_ROUTINE                                  ; Подпрограмма вывода названия подпункта меню на
                             дисплей
0204   01??           00150         CLRF    SYMBOL_POINTER
0205                  00151 STRING_SUBMENU
0205   2???           00152         CALL    SWITCH_SUBMENU_TABLE
0206   39FF           00153         ANDLW   0FFH
0207   1903           00154         BTFSC   STATUS,Z
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0208   0008           00155         RETURN 
0209   2???           00156         CALL    SEND_LCD_SYMBOL
Message[305]: Using default destination of 1 (file).
020A   0A??           00157         INCF    SYMBOL_POINTER  
020B   2???           00158         GOTO    STRING_SUBMENU
                      00159 ;===================================================================================================
020C                  00160 MENU_HEANDLER                                                   ; Обработчик меню
020C   01??           00161         CLRF    INDEX_MENU                                      ; Была нажатая какая-то кнопка, очистим 
                            индекс пункта меню                                      
                      00162 
Warning[205]: Found directive in column 1. (IF)
                      00163 IF      USE_MOVING_CURSOR       &       !USE_TOP_LAST_CURSOR
                      00164         MOVLW   B'11110000'                                     ; Сбросим признак нажатия для всех кнопо
                            к                                       
                      00165         ANDWF   FLAGS                                           
                      00166         BSF             PRESS_UP                                        ; И установим признак нажатия то
                            лько для кнопки "ВВЕРХ"
                      00167 ENDIF
                      00168 ;-------------------------------------------------------------------------------------------------------
                            ---------------------
020D                  00169 SWITCH_MENU                                                             ; Поместим курсор на нужный пунк
                            т меню                                                  
                      00170 
Warning[205]: Found directive in column 1. (IF)
                      00171 IF      USE_MOVING_CURSOR       &       USE_TOP_LAST_CURSOR
020D   08??           00172         MOVFW   INDEX_MENU
020E   1D03           00173         BTFSS   STATUS,Z
020F   2???           00174         GOTO    CHECK_1         
0210   30F0           00175         MOVLW   B'11110000'                                     ; Сбросим признак нажатия для всех кнопо
                            к                                       
Message[305]: Using default destination of 1 (file).
0211   05??           00176         ANDWF   FLAGS   
0212   1400           00177         BSF             PRESS_UP                                        ; И установим признак нажатия то
                            лько для кнопки "ВВЕРХ"
0213   2???           00178         GOTO    SKIP_CHECK_1
0214                  00179 CHECK_1
0214   3C04           00180         SUBLW   NUM_OF_MAIN_MENU_PUNKTS-1       ; Сравниваем с количеством пунктов меню
0215   1D03           00181         BTFSS   STATUS,Z        
0216   2???           00182         GOTO    SKIP_CHECK_1    
0217   30F0           00183         MOVLW   B'11110000'                                     ; Сбросим признак нажатия для всех кнопо
                            к                                       
Message[305]: Using default destination of 1 (file).
0218   05??           00184         ANDWF   FLAGS
0219   1480           00185         BSF             PRESS_DOWN                                      ; И установим признак нажатия то
                            лько для кнопки "ВНИЗ"
021A                  00186 SKIP_CHECK_1
Warning[205]: Found directive in column 1. (ENDIF)
                      00187 ENDIF
                      00188 
021A   2???           00189         CALL    CLR_DISPLAY_ROUTINE                     ; Очистим дисплей перед самой перерисовкой пункт
                            ов меню, чтобы уменьшить моргание
                      00190 
Warning[205]: Found directive in column 1. (IF)
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00191 IF      USE_MOVING_CURSOR
021B   1C00           00192         BTFSS   PRESS_UP
021C   2???           00193         GOTO    PRESSING_DOWN                   
021D   2???           00194         CALL    SWITCH_MENU_ROUTINE                     ; Рисуем текущий пункт меню     
                      00195         DRAW_KURSOR     LAST_SYMBOL_FIRST_LINE  ; Нарисум курсор в конце 1-й строчки
021E   308F               M                         MOVLW   LAST_SYMBOL_FIRST_LINE
021F   2???               M                         CALL    DRAW_KURSOR_ROUTINE
0220   2???           00196         CALL    SECOND_STRING_ROUTINE           ; Указатель на 2 строку
Message[305]: Using default destination of 1 (file).
0221   0A??           00197         INCF    INDEX_MENU                                      ; Берем следующий пункт
0222   08??           00198         MOVFW   INDEX_MENU      
0223   3C05           00199         SUBLW   NUM_OF_MAIN_MENU_PUNKTS         ; Сравниваем с количеством пунктов меню
0224   1903           00200         BTFSC   STATUS,Z
0225   2???           00201         GOTO    CORRECT_INDEX_MENU                      
0226   2???           00202         CALL    SWITCH_MENU_ROUTINE                     ; Рисуем пункт меню под текущим 
Message[305]: Using default destination of 1 (file).
0227   03??           00203         DECF    INDEX_MENU                                      ; Не забудем вернуть назад текущий пункт
                             меню   
0228   2???           00204         GOTO    SKIP_CORRECT_INDEX_MENU_3
0229                  00205 CORRECT_INDEX_MENU                                              ; Достигли последнего пункта меню, следу
                            ющим отображаем 1 пункт
0229   01??           00206         CLRF    INDEX_MENU
022A   2???           00207         CALL    SWITCH_MENU_ROUTINE
022B   3004           00208         MOVLW   NUM_OF_MAIN_MENU_PUNKTS-1
022C   00??           00209         MOVWF   INDEX_MENU      
022D   2???           00210         GOTO    SKIP_CORRECT_INDEX_MENU_3
                      00211 
022E                  00212 PRESSING_DOWN
Message[305]: Using default destination of 1 (file).
022E   03??           00213         DECF    INDEX_MENU                                      ; Берем предыдущий пункт меню
022F   1B80           00214         BTFSC   INDEX_MENU,.7                           ; Проверяем на "<0"     простой проверкой 7 бита
                            , максимальное количество пунктов меню ограничено 64
0230   2???           00215         GOTO    CORRECT_INDEX_MENU_2
0231   2???           00216         CALL    SWITCH_MENU_ROUTINE                     ; Рисуем предыдущий пункт меню
0232   2???           00217         CALL    SECOND_STRING_ROUTINE           ; Указатель на 2 строку
Message[305]: Using default destination of 1 (file).
0233   0A??           00218         INCF    INDEX_MENU                                      ; Вернем текущий пункт                  
                                            
0234   08??           00219         MOVFW   INDEX_MENU      
0235   2???           00220         GOTO    SKIP_CORRECT_INDEX_MENU_2
0236                  00221 CORRECT_INDEX_MENU_2
0236   3004           00222         MOVLW   NUM_OF_MAIN_MENU_PUNKTS-1
0237   00??           00223         MOVWF   INDEX_MENU
0238   2???           00224         CALL    SWITCH_MENU_ROUTINE                     ; Рисуем предыдущий пункт меню
0239   2???           00225         CALL    SECOND_STRING_ROUTINE           ; Указатель на 2 строку
023A   01??           00226         CLRF    INDEX_MENU
023B                  00227 SKIP_CORRECT_INDEX_MENU_2
023B   2???           00228         CALL    SWITCH_MENU_ROUTINE                     ; Рисуем текущий пункт меню под предыдущим 
                      00229         DRAW_KURSOR     LAST_SYMBOL_SECOND_LINE ; Нарисум курсор в конце 2-й строчки
023C   30CF               M                         MOVLW   LAST_SYMBOL_SECOND_LINE
023D   2???               M                         CALL    DRAW_KURSOR_ROUTINE
023E                  00230 SKIP_CORRECT_INDEX_MENU_3
                      00231 
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Warning[205]: Found directive in column 1. (ELSE)
                      00232 ELSE
                      00233         CALL    SWITCH_MENU_ROUTINE                     ; Рисуем текущий пункт меню
                      00234         CALL    SECOND_STRING_ROUTINE           ; Указатель на 2 строку
                      00235         INCF    INDEX_MENU                                      ; Берем следующий пункт
                      00236         MOVFW   INDEX_MENU      
                      00237         SUBLW   NUM_OF_MAIN_MENU_PUNKTS         ; Сравниваем с количеством пунктов меню
                      00238         BTFSC   STATUS,Z
                      00239         GOTO    CORRECT_INDEX_MENU                      
                      00240         CALL    SWITCH_MENU_ROUTINE                     ; Рисуем пункт меню под текущим 
                      00241         DECF    INDEX_MENU                                      ; Не забудем вернуть назад текущий пункт
                             меню   
                      00242         GOTO    SKIP_CORRECT_INDEX_MENU
                      00243 CORRECT_INDEX_MENU                                              ; Достигли последнего пункта меню, следу
                            ющим отображаем 1 пункт
                      00244         CLRF    INDEX_MENU
                      00245         CALL    SWITCH_MENU_ROUTINE
                      00246         MOVLW   NUM_OF_MAIN_MENU_PUNKTS-1
                      00247         MOVWF   INDEX_MENU      
                      00248 SKIP_CORRECT_INDEX_MENU
                      00249 ENDIF
                      00250 
023E   2???           00251         CALL    DEBOUNCE_DELAY                          ; Процедура антидребезга, вызывается при первом 
                            входе в меню, при нажатии кнопок "Вверх", "Вниз", выходе из подпункта меню
                      00252 
Warning[205]: Found directive in column 1. (IF)
                      00253 IF      USE_RBIE
023F   30F0           00254         MOVLW   B'11110000'                                     ; Сбросим признак нажатия для всех кнопо
                            к                                       
Message[305]: Using default destination of 1 (file).
0240   05??           00255         ANDWF   FLAGS   
0241   100B           00256         BCF             INTCON,RBIF                                     ; Сбросим флаг возможно вызваног
                            о прерывания от кнопок
0242   158B           00257         BSF             INTCON,RBIE                                     ; И разрешим прерывания от кнопо
                            к
Warning[205]: Found directive in column 1. (ENDIF)
                      00258 ENDIF
                      00259 
0243   3014           00260         MOVLW   EXIT_DELAY                                      ; Заносим счетчик проходов опроса клавиш
0244   00??           00261         MOVWF   MENU_COUNTER
0245   01??           00262         CLRF    TEMP_1
0246   01??           00263         CLRF    TEMP_2
0247                  00264 LOOP_MENU                                                               ; Вычисляем нажатую клавишу
                      00265 
Warning[205]: Found directive in column 1. (IF)
                      00266 IF      USE_RBIE
0247   1800           00267         BTFSC   PRESS_UP
0248   2???           00268         GOTO    CURSOR_UP_MENU                          
0249   1880           00269         BTFSC   PRESS_DOWN
024A   2???           00270         GOTO    CURSOR_DOWN_MENU
024B   1900           00271         BTFSC   PRESS_ENTER
024C   2???           00272         GOTO    ENTER_MENU
024D   1980           00273         BTFSC   PRESS_EXIT
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

024E   2???           00274         GOTO    EXIT_MENU
Warning[205]: Found directive in column 1. (ELSE)
                      00275 ELSE
                      00276         BTFSS   UP
                      00277         GOTO    CURSOR_UP_MENU                          
                      00278         BTFSS   DOWN
                      00279         GOTO    CURSOR_DOWN_MENU
                      00280         BTFSS   ENTER
                      00281         GOTO    ENTER_MENU
                      00282         BTFSS   EXIT
                      00283         GOTO    EXIT_MENU
                      00284 ENDIF
                      00285 ;-----------------------------------------------------------------                                      
                                                                    
Message[305]: Using default destination of 1 (file).
024F   0B??           00286         DECFSZ  TEMP_1                                          ; Ни одна клавиша не нажата             
                                                            
0250   2???           00287         GOTO    LOOP_MENU                                       ; Цикл ожидания нажатия в главном меню  
Message[305]: Using default destination of 1 (file).
0251   0B??           00288         DECFSZ  TEMP_2  
0252   2???           00289         GOTO    LOOP_MENU
Message[305]: Using default destination of 1 (file).
0253   0B??           00290         DECFSZ  MENU_COUNTER                            ; Декремент счетчика проходов опроса клавиш     
0254   2???           00291         GOTO    LOOP_MENU
0255   2???           00292         GOTO    ZASTAVKA                                        ; Вышел таймаут нахождения в меню, выход
                            им в заставку   
                      00293 ;-----------------------------------------------------------------
0256                  00294 CURSOR_UP_MENU                                                  ; Была нажата клавиша "Вверх"
                      00295 
Warning[205]: Found directive in column 1. (IF)
                      00296 IF      USE_MOVING_CURSOR       &       !USE_RBIE
                      00297         MOVLW   B'11110000'                                     ; Сбросим признак нажатия для всех кнопо
                            к                                       
                      00298         ANDWF   FLAGS                                           
                      00299         BSF             PRESS_UP                                        ; И установим признак нажатия то
                            лько для кнопки "ВВЕРХ"
                      00300 ENDIF
                      00301 
Message[305]: Using default destination of 1 (file).
0256   03??           00302         DECF    INDEX_MENU                                      ; Берем предыдущий пункт меню
0257   1F80           00303         BTFSS   INDEX_MENU,.7                           ; Проверяем на "<0"     простой проверкой 7 бита
                            , максимальное количество пунктов меню ограничено 64
0258   2???           00304         GOTO    SWITCH_MENU
0259   3004           00305         MOVLW   NUM_OF_MAIN_MENU_PUNKTS-1       ; Стало "<0", сделаем текущим последний пункт меню. Учит
                            ываем, что индекс пункта меню на 1 меньше его порядкового номера
025A   00??           00306         MOVWF   INDEX_MENU
025B   2???           00307         GOTO    SWITCH_MENU                                     ; Отрисовываем новый текущий пункт меню
                      00308 ;-----------------------------------------------------------------
025C                  00309 CURSOR_DOWN_MENU                                                ; Была нажата клавиша "Вниз"
                      00310 
Warning[205]: Found directive in column 1. (IF)
                      00311 IF      USE_MOVING_CURSOR       &       !USE_RBIE
                      00312         MOVLW   B'11110000'                                     ; Сбросим признак нажатия для всех кнопо
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 38


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            к                                       
                      00313         ANDWF   FLAGS                                           
                      00314         BSF             PRESS_DOWN                                      ; И установим признак нажатия то
                            лько для кнопки "ВНИЗ"
                      00315 ENDIF
                      00316 
Message[305]: Using default destination of 1 (file).
025C   0A??           00317         INCF    INDEX_MENU                                      ; Берем следущий пункт меню
025D   08??           00318         MOVFW   INDEX_MENU
025E   3C05           00319         SUBLW   NUM_OF_MAIN_MENU_PUNKTS         ; Достигли последнего ?
025F   1903           00320         BTFSC   STATUS,Z
0260   01??           00321         CLRF    INDEX_MENU                                      ; Если да, делаем текущим первый пункт м
                            еню     
0261   2???           00322         GOTO    SWITCH_MENU                                     ; Отрисовываем новый текущий пункт меню
                      00323 ;-----------------------------------------------------------------
0262                  00324 EXIT_MENU                                                               ; Была нажата клавиша "Выход"
                      00325 
Warning[205]: Found directive in column 1. (IF)
                      00326 IF      USE_RBIE
0262   30F0           00327         MOVLW   B'11110000'                                     ; Сбросим признак нажатия для всех кнопо
                            к                                       
Message[305]: Using default destination of 1 (file).
0263   05??           00328         ANDWF   FLAGS   
0264   100B           00329         BCF             INTCON,RBIF                                     ; Сбросим флаг возможно вызваног
                            о прерывания
0265   158B           00330         BSF             INTCON,RBIE                                     ; И разрешим прерывания от кнопо
                            к
Warning[205]: Found directive in column 1. (ELSE)
                      00331 ELSE
                      00332         CALL    DEBOUNCE_DELAY  
                      00333 ENDIF
0266   2???           00334         GOTO    ZASTAVKA                                        ; Выходим в заставку
                      00335 ;-----------------------------------------------------------------
0267                  00336 ENTER_MENU                                                              ; Была нажата клавиша "Вход", за
                            ходим в текущий пункт меню
                      00337 
Warning[205]: Found directive in column 1. (IF)
                      00338 IF      USE_MENU_ACTION         
                      00339         MOVFW   INDEX_MENU                                      ; Берем текущий пункт меню
                      00340         MOVWF   TEMP_1                                          ; Заносим в счетчик
                      00341         INCF    TEMP_1                                          ; Учитываем, что нумерация начинается с 
                            0
                      00342         MOVLW   ACTIONS_MENU_FLAGS                      ; Берем флаги действий пунктов меню
                      00343         MOVWF   TEMP_2                                          ; И заносим в переменную
                      00344 LOOP_1
                      00345         DECFSZ  TEMP_1
                      00346         GOTO    ROTATE_ACTION_MENU_FLAGS
                      00347         BTFSC   STATUS,C                                        ; Флаг действия текущего пункта меню выд
                            авлен в бит переноса, анализируем его
                      00348         GOTO    MENU_ACTION                                     ; У текущего пункта меню есть действие, 
                            выполняем его
                      00349         GOTO    END_MENU_ACTION
                      00350 ROTATE_ACTION_MENU_FLAGS
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 39


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00351         RRF             TEMP_2                                          ; Перебор флагов действий всех п
                            унктов меню
                      00352         GOTO    LOOP_1  
                      00353 END_MENU_ACTION
                      00354 ENDIF
                      00355 
0267   2???           00356         CALL    NUM_OF_SUBMENU_TABLE            ; Получаем количество подпунктов в этом меню
0268   3C00           00357         SUBLW   .0
0269   1903 2???      00358         BZ              SWITCH_MENU                                     ; Если 0, сразу на выход без про
                            рисовки чего либо       
026B   01??           00359         CLRF    INDEX_SUBMENU                           ; Очистим индекс пункта подменю 
                      00360 
Warning[205]: Found directive in column 1. (IF)
                      00361 IF      USE_MOVING_CURSOR       &       !USE_TOP_LAST_CURSOR
                      00362         MOVLW   B'11110000'                                     ; Сбросим признак нажатия для всех кнопо
                            к                                       
                      00363         ANDWF   FLAGS                                           
                      00364         BSF             PRESS_UP                                        ; И установим признак нажатия то
                            лько для кнопки "ВВЕРХ"
                      00365 ENDIF
                      00366 
026C                  00367 SWITCH_SUBMENU                                                  ; Поместим курсор на нужный подпункт нуж
                            ного пункта
                      00368 
Warning[205]: Found directive in column 1. (IF)
                      00369 IF      USE_MOVING_CURSOR       &       USE_TOP_LAST_CURSOR
026C   08??           00370         MOVFW   INDEX_SUBMENU
026D   1D03           00371         BTFSS   STATUS,Z
026E   2???           00372         GOTO    CHECK_2         
026F   30F0           00373         MOVLW   B'11110000'                                     ; Сбросим признак нажатия для всех кнопо
                            к                                       
Message[305]: Using default destination of 1 (file).
0270   05??           00374         ANDWF   FLAGS   
0271   1400           00375         BSF             PRESS_UP                                        ; И установим признак нажатия то
                            лько для кнопки "ВВЕРХ"
0272   2???           00376         GOTO    SKIP_CHECK_2
0273                  00377 CHECK_2
0273   2???           00378         CALL    NUM_OF_SUBMENU_TABLE            ; Получаем количество подпунктов в этом меню
0274   00??           00379         MOVWF   TEMP_1  
0275   03??           00380         DECF    TEMP_1, W                                       ; Учитываем, что индекс подпункта начина
                            ется с 0
0276   02??           00381         SUBWF   INDEX_SUBMENU,W                         ; Сравниваем с количеством подпунктов меню
0277   1D03           00382         BTFSS   STATUS,Z        
0278   2???           00383         GOTO    SKIP_CHECK_2    
0279   30F0           00384         MOVLW   B'11110000'                                     ; Сбросим признак нажатия для всех кнопо
                            к                                       
Message[305]: Using default destination of 1 (file).
027A   05??           00385         ANDWF   FLAGS
027B   1480           00386         BSF             PRESS_DOWN                                      ; И установим признак нажатия то
                            лько для кнопки "ВНИЗ"
027C                  00387 SKIP_CHECK_2
Warning[205]: Found directive in column 1. (ENDIF)
                      00388 ENDIF
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 40


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00389 
027C   2???           00390         CALL    CLR_DISPLAY_ROUTINE                     ; Очистим дисплей перед самой перерисовкой подпу
                            нктов меню, чтобы уменьшить моргание
                      00391 
Warning[205]: Found directive in column 1. (IF)
                      00392 IF      USE_MOVING_CURSOR
027D   1C00           00393         BTFSS   PRESS_UP
027E   2???           00394         GOTO    PRESSING_DOWN_2                 
027F   2???           00395         CALL    SWITCH_SUBMENU_ROUTINE          ; Рисуем текущий подпункт меню
                      00396 
0280   2???           00397         CALL    NUM_OF_SUBMENU_TABLE            ; Получаем количество подпунктов в этом меню
0281   3C01           00398         SUBLW   .1
0282   1903 2???      00399         BZ              SKIP_CORRECT_INDEX_SUBMENU_3; Если 1, пропускаем прорисовку 2-й строки
                      00400 
                      00401         DRAW_KURSOR     LAST_SYMBOL_FIRST_LINE  ; Нарисум курсор в конце 1-й строчки
0284   308F               M                         MOVLW   LAST_SYMBOL_FIRST_LINE
0285   2???               M                         CALL    DRAW_KURSOR_ROUTINE
0286   2???           00402         CALL    SECOND_STRING_ROUTINE           ; Указатель на 2 строку
Message[305]: Using default destination of 1 (file).
0287   0A??           00403         INCF    INDEX_SUBMENU                           ; Берем следующий пункт
0288   2???           00404         CALL    NUM_OF_SUBMENU_TABLE            ; Получаем количество подпунктов в этом меню            
                                    
0289   02??           00405         SUBWF   INDEX_SUBMENU,W                         ; Сравниваем с количеством подпунктов меню
028A   1903           00406         BTFSC   STATUS,Z
028B   2???           00407         GOTO    CORRECT_INDEX_SUBMENU                   
028C   2???           00408         CALL    SWITCH_SUBMENU_ROUTINE          ; Рисуем подпункт меню под текущим 
Message[305]: Using default destination of 1 (file).
028D   03??           00409         DECF    INDEX_SUBMENU                           ; Не забудем вернуть назад текущий пункт меню   
028E   2???           00410         GOTO    SKIP_CORRECT_INDEX_SUBMENU_3
028F                  00411 CORRECT_INDEX_SUBMENU                                   ; Достигли последнего подпункта меню, следующим 
                            отображаем 1 подпункт
028F   01??           00412         CLRF    INDEX_SUBMENU
0290   2???           00413         CALL    SWITCH_SUBMENU_ROUTINE
0291   2???           00414         CALL    NUM_OF_SUBMENU_TABLE
0292   00??           00415         MOVWF   INDEX_SUBMENU
Message[305]: Using default destination of 1 (file).
0293   03??           00416         DECF    INDEX_SUBMENU                           ; Учитываем, что индекс подпункта начинается с 0
                                    
0294   2???           00417         GOTO    SKIP_CORRECT_INDEX_SUBMENU_3
                      00418 
0295                  00419 PRESSING_DOWN_2
Message[305]: Using default destination of 1 (file).
0295   03??           00420         DECF    INDEX_SUBMENU                           ; Берем предыдущий пункт меню
0296   1B80           00421         BTFSC   INDEX_SUBMENU,.7                        ; Проверяем на "<0"     простой проверкой 7 бита
                            , максимальное количество пунктов меню ограничено 64
0297   2???           00422         GOTO    CORRECT_INDEX_SUBMENU_2
0298   2???           00423         CALL    SWITCH_SUBMENU_ROUTINE          ; Рисуем предыдущий пункт меню
0299   2???           00424         CALL    SECOND_STRING_ROUTINE           ; Указатель на 2 строку
Message[305]: Using default destination of 1 (file).
029A   0A??           00425         INCF    INDEX_SUBMENU                           ; Вернем текущий пункт                          
                                    
029B   08??           00426         MOVFW   INDEX_SUBMENU   
029C   2???           00427         GOTO    SKIP_CORRECT_INDEX_SUBMENU_2
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 41


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

029D                  00428 CORRECT_INDEX_SUBMENU_2
029D   2???           00429         CALL    NUM_OF_SUBMENU_TABLE            ; Стало "<0", возвращаем количество пунктов в даном подм
                            еню     
029E   00??           00430         MOVWF   INDEX_SUBMENU                           ; Сделаем текущим последний пункт подменю
Message[305]: Using default destination of 1 (file).
029F   03??           00431         DECF    INDEX_SUBMENU                           ; Учитываем, что индекс пункта подменю на 1 мень
                            ше его порядкового номера
02A0   2???           00432         CALL    SWITCH_SUBMENU_ROUTINE          ; Рисуем предыдущий пункт меню
02A1   2???           00433         CALL    SECOND_STRING_ROUTINE           ; Указатель на 2 строку
02A2   01??           00434         CLRF    INDEX_SUBMENU
02A3                  00435 SKIP_CORRECT_INDEX_SUBMENU_2
02A3   2???           00436         CALL    SWITCH_SUBMENU_ROUTINE          ; Рисуем текущий пункт меню под предыдущим 
                      00437         DRAW_KURSOR     LAST_SYMBOL_SECOND_LINE ; Нарисум курсор в конце 2-й строчки
02A4   30CF               M                         MOVLW   LAST_SYMBOL_SECOND_LINE
02A5   2???               M                         CALL    DRAW_KURSOR_ROUTINE
02A6                  00438 SKIP_CORRECT_INDEX_SUBMENU_3
                      00439 
Warning[205]: Found directive in column 1. (ELSE)
                      00440 ELSE
                      00441         CALL    SWITCH_SUBMENU_ROUTINE          ; Рисуем текущий подпункт меню
                      00442 
                      00443         CALL    NUM_OF_SUBMENU_TABLE            ; Получаем количество подпунктов в этом меню
                      00444         SUBLW   .1
                      00445         BZ              SKIP_CORRECT_INDEX_SUBMENU      ; Если 1, пропускаем прорисовку 2-й строки
                      00446 
                      00447         CALL    SECOND_STRING_ROUTINE           ; Указатель на 2 строку
                      00448         INCF    INDEX_SUBMENU
                      00449         CALL    NUM_OF_SUBMENU_TABLE                    
                      00450         SUBWF   INDEX_SUBMENU,W                         ; Сравниваем с количеством подпунктов меню
                      00451         BTFSC   STATUS,Z
                      00452         GOTO    CORRECT_INDEX_SUBMENU
                      00453         CALL    SWITCH_SUBMENU_ROUTINE          ; Рисуем подпункт меню под текущим 
                      00454         DECF    INDEX_SUBMENU                           ; Не забудем вернуть назад текущий подпункт меню
                      00455         GOTO    SKIP_CORRECT_INDEX_SUBMENU      
                      00456 CORRECT_INDEX_SUBMENU                                   ; Достигли последнего подпункта меню, следующим 
                            отображаем 1 подпункт
                      00457         CLRF    INDEX_SUBMENU   
                      00458         CALL    SWITCH_SUBMENU_ROUTINE
                      00459         CALL    NUM_OF_SUBMENU_TABLE
                      00460         MOVWF   INDEX_SUBMENU   
                      00461         DECF    INDEX_SUBMENU                           ; Учитываем, что индекс подпункта начинается с 0
                      00462 SKIP_CORRECT_INDEX_SUBMENU
                      00463 ENDIF
                      00464 
02A6   2???           00465         CALL    DEBOUNCE_DELAY                          ; Процедура антидребезга, вызывается при первом 
                            входе в подпункт меню, при нажатии кнопок "Вверх", "Вниз", выходе из действия подпункта меню
                      00466 
Warning[205]: Found directive in column 1. (IF)
                      00467 IF      USE_RBIE
02A7   30F0           00468         MOVLW   B'11110000'                                     ; Сбросим признак нажатия для всех кнопо
                            к                                       
Message[305]: Using default destination of 1 (file).
02A8   05??           00469         ANDWF   FLAGS   
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 42


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02A9   100B           00470         BCF             INTCON,RBIF                                     ; Сбросим флаг возможно вызваног
                            о прерывания
02AA   158B           00471         BSF             INTCON,RBIE                                     ; И разрешим прерывания от кнопо
                            к
Warning[205]: Found directive in column 1. (ENDIF)
                      00472 ENDIF
                      00473 
02AB   3014           00474         MOVLW   EXIT_DELAY                                      ; Заносим счетчик проходов опроса клавиш
02AC   00??           00475         MOVWF   MENU_COUNTER
02AD   01??           00476         CLRF    TEMP_1
02AE   01??           00477         CLRF    TEMP_2
02AF                  00478 LOOP_SUBMENU                                                    ; Мы зашли в пункт меню, ждем нажатия сл
                            едующей кнопки
                      00479 
Warning[205]: Found directive in column 1. (IF)
                      00480 IF      USE_RBIE
02AF   1800           00481         BTFSC   PRESS_UP
02B0   2???           00482         GOTO    CURSOR_UP_SUBMENU                               
02B1   1880           00483         BTFSC   PRESS_DOWN
02B2   2???           00484         GOTO    CURSOR_DOWN_SUBMENU
02B3   1900           00485         BTFSC   PRESS_ENTER
02B4   2???           00486         GOTO    ENTER_SUBMENU
02B5   1980           00487         BTFSC   PRESS_EXIT
02B6   2???           00488         GOTO    EXIT_SUBMENU
Warning[205]: Found directive in column 1. (ELSE)
                      00489 ELSE
                      00490         BTFSS   UP
                      00491         GOTO    CURSOR_UP_SUBMENU                               
                      00492         BTFSS   DOWN
                      00493         GOTO    CURSOR_DOWN_SUBMENU
                      00494         BTFSS   ENTER
                      00495         GOTO    ENTER_SUBMENU
                      00496         BTFSS   EXIT
                      00497         GOTO    EXIT_SUBMENU
                      00498 ENDIF
                      00499 ;-----------------------------------------------------------------
Message[305]: Using default destination of 1 (file).
02B7   0B??           00500         DECFSZ  TEMP_1                                          ; Ни одна клавиша не нажата     
02B8   2???           00501         GOTO    LOOP_SUBMENU                            ; Цикл ожидания нажатия в пункте меню
Message[305]: Using default destination of 1 (file).
02B9   0B??           00502         DECFSZ  TEMP_2  
02BA   2???           00503         GOTO    LOOP_SUBMENU
Message[305]: Using default destination of 1 (file).
02BB   0B??           00504         DECFSZ  MENU_COUNTER                            ; Декремент счетчика проходов опроса клавиш     
                                    
02BC   2???           00505         GOTO    LOOP_SUBMENU
02BD   2???           00506         GOTO    SWITCH_MENU                                     ; Вышел таймаут нахождения в подменю, вы
                            ходим в предыдущий пункт меню
                      00507 ;-----------------------------------------------------------------
02BE                  00508 CURSOR_UP_SUBMENU                                               ; Была нажата клавиша "Вверх"
                      00509 
Warning[205]: Found directive in column 1. (IF)
                      00510 IF      USE_MOVING_CURSOR       &       !USE_RBIE
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 43


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00511         MOVLW   B'11110000'                                     ; Сбросим признак нажатия для всех кнопо
                            к                                       
                      00512         ANDWF   FLAGS                                           
                      00513         BSF             PRESS_UP                                        ; И установим признак нажатия то
                            лько для кнопки "ВВЕРХ"
                      00514 ENDIF
                      00515 
Message[305]: Using default destination of 1 (file).
02BE   03??           00516         DECF    INDEX_SUBMENU                           ; Берем предыдущий пункт подменю
02BF   1F80           00517         BTFSS   INDEX_SUBMENU,.7                        ; Проверяем на "<0"     простой проверкой 7 бита
                            , максимальное количество подпунктов меню ограничено 64
02C0   2???           00518         GOTO    SWITCH_SUBMENU  
02C1   2???           00519         CALL    NUM_OF_SUBMENU_TABLE            ; Стало "<0", возвращаем количество пунктов в даном подм
                            еню     
02C2   00??           00520         MOVWF   INDEX_SUBMENU                           ; Сделаем текущим последний пункт подменю
Message[305]: Using default destination of 1 (file).
02C3   03??           00521         DECF    INDEX_SUBMENU                           ; Учитываем, что индекс пункта подменю на 1 мень
                            ше его порядкового номера
02C4   2???           00522         GOTO    SWITCH_SUBMENU                          ; Отрисовываем новый текущий подпункт меню      
                      00523 ;-----------------------------------------------------------------
02C5                  00524 CURSOR_DOWN_SUBMENU                                             ; Была нажата клавиша "Вниз"
                      00525 
Warning[205]: Found directive in column 1. (IF)
                      00526 IF      USE_MOVING_CURSOR       &       !USE_RBIE
                      00527         MOVLW   B'11110000'                                     ; Сбросим признак нажатия для всех кнопо
                            к                                       
                      00528         ANDWF   FLAGS                                           
                      00529         BSF             PRESS_DOWN                                      ; И установим признак нажатия то
                            лько для кнопки "ВНИЗ"
                      00530 ENDIF
                      00531 
Message[305]: Using default destination of 1 (file).
02C5   0A??           00532         INCF    INDEX_SUBMENU                           ; Берем следущий пункт подменю
02C6   2???           00533         CALL    NUM_OF_SUBMENU_TABLE            ; Возвращаем количество пунктов в даном подменю 
02C7   02??           00534         SUBWF   INDEX_SUBMENU,W                         ; Достигли последнего ? 
02C8   1903           00535         BTFSC   STATUS,Z
02C9   01??           00536         CLRF    INDEX_SUBMENU                           ; Если да, делаем текущим первый подпункт меню  
                                    
02CA   2???           00537         GOTO    SWITCH_SUBMENU                          ; Отрисовываем новый текущий подпункт меню
                      00538 ;-----------------------------------------------------------------      
02CB                  00539 EXIT_SUBMENU                                                    ; Была нажата клавиша "Выход"
02CB   01??           00540         CLRF    INDEX_SUBMENU                           ; Обнуляем индекс пункта подменю, чтобы при след
                            ующем заходе в любой пункт меню курсор находился на 1 пункте подменю                    
02CC   2???           00541         GOTO    SWITCH_MENU                                     ; Выходим в меню
                      00542 ;-----------------------------------------------------------------
02CD                  00543 ENTER_SUBMENU                                                   ; Была нажата клавиша "Вход"
02CD   2???           00544         CALL    CLR_DISPLAY_ROUTINE                     ; Очистим дисплей
02CE   2???           00545         GOTO    SWITCH_ACTION                           ; Делаем действие текущего подпункта меню
02CF                  00546 END_ACTION
                      00547 ;-----------------------------------------------------------------
02CF   01??           00548         CLRF    SYMBOL_POINTER                          ; Рисуем подтверждение действия
02D0                  00549 STRING_ACTION_COMPLETE
02D0   2???           00550         CALL    TABLE_ACTION_COMPLETE   
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 44


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02D1   39FF           00551         ANDLW   0FFH
02D2   1903           00552         BTFSC   STATUS,Z
02D3   2???           00553         GOTO    OUT_ACTION_COMPLETE
02D4   2???           00554         CALL    SEND_LCD_SYMBOL
Message[305]: Using default destination of 1 (file).
02D5   0A??           00555         INCF    SYMBOL_POINTER  
02D6   2???           00556         GOTO    STRING_ACTION_COMPLETE
02D7                  00557 OUT_ACTION_COMPLETE
02D7   01??           00558         CLRF    TEMP_3                                          ; Задержка, чтобы успеть прочесть уведом
                            ление о выполнении действи
02D8   2???           00559         CALL    DEBOUNCE_DELAY
Message[305]: Using default destination of 1 (file).
02D9   0B??           00560         DECFSZ  TEMP_3
02DA   2???           00561         GOTO    $-2
                      00562 ;-----------------------------------------------------------------
02DB   2???           00563         GOTO    SWITCH_SUBMENU                          ; И идем отрисовывать подпункт меню, курсор на т
                            ом же подпункте, что и был
                      00564 ;===================================================================================================
02DC                  00565 ZASTAVKA
02DC   2???           00566         CALL    CLR_DISPLAY_ROUTINE                     ; Очистим дисплей
02DD   01??           00567         CLRF    SYMBOL_POINTER
02DE                  00568 FIRST_STRING
02DE   2???           00569         CALL    TABLE_ZASTAVKA_FIRST_STRING     
02DF   39FF           00570         ANDLW   0FFH
02E0   1903           00571         BTFSC   STATUS,Z
02E1   2???           00572         GOTO    OUT_FIRST_STRING
02E2   2???           00573         CALL    SEND_LCD_SYMBOL
Message[305]: Using default destination of 1 (file).
02E3   0A??           00574         INCF    SYMBOL_POINTER  
02E4   2???           00575         GOTO    FIRST_STRING
02E5                  00576 OUT_FIRST_STRING
02E5   30C0           00577         MOVLW   SECOND_LINE     
02E6   2???           00578         CALL    SEND_LCD_COMMAND
02E7   01??           00579         CLRF    SYMBOL_POINTER
02E8                  00580 NEXT_STRING
02E8   2???           00581         CALL    TABLE_ZASTAVKA_SECOND_STRING
02E9   39FF           00582         ANDLW   0FFH
02EA   1903           00583         BTFSC   STATUS,Z
02EB   2???           00584         GOTO    OUT_NEXT_STRING
02EC   2???           00585         CALL    SEND_LCD_SYMBOL
Message[305]: Using default destination of 1 (file).
02ED   0A??           00586         INCF    SYMBOL_POINTER  
02EE   2???           00587         GOTO    NEXT_STRING
02EF                  00588 OUT_NEXT_STRING
02EF   2???           00589         GOTO    MAIN
                      00590 ;===================================================================================================
02F0                  00591 DRAW_KURSOR_ROUTINE                                             ; Процедура рисования курсора. В w лежит
                             адрес
02F0   2???           00592         CALL    SEND_LCD_COMMAND
02F1   303C           00593         MOVLW   '<'                                                     ; Нарисуем там курсор
02F2   2???           00594         CALL    SEND_LCD_SYMBOL
02F3   0008           00595         RETURN
                      00596 ;===================================================================================================
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 45


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02F4                  00597 DEBOUNCE_DELAY                                                  ; Подпрограмма антидребезговой задержки
02F4   3003           00598         MOVLW   .3                                                      ; Количество проходов подбираетс
                            я экспериментальным путем
02F5   00??           00599         MOVWF   TEMP_2
02F6   01??           00600         CLRF    TEMP_1
02F7                  00601 LOOP_DELAY
02F7   0806           00602         MOVFW   PORTB                                           
02F8   380F           00603         IORLW   B'00001111'                                     ; Установим незначущие разряды
02F9   3E01           00604         ADDLW   .1
02FA   1D03           00605         BTFSS   STATUS,Z
02FB   2???           00606         GOTO    LOOP_DELAY                                      ; Если хоть одна кнопка нажата, просто з
                            ациклимся
Message[305]: Using default destination of 1 (file).
02FC   0B??           00607         DECFSZ  TEMP_1  
02FD   2???           00608         GOTO    $-1
Message[305]: Using default destination of 1 (file).
02FE   0B??           00609         DECFSZ  TEMP_2  
02FF   2???           00610         GOTO    LOOP_DELAY
0300   0008           00611         RETURN
                      00612 ;===================================================================================================
                      00613         END
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 46


SYMBOL TABLE
  LABEL                             VALUE 

ACTION_COMPLETE_STRING            "Action Complete!"
ADD_PCL                           
C                                 00000000
CHECK_1                           00000214
CHECK_2                           00000273
CLR_DISP                          00000001
CLR_DISPLAY_ROUTINE               000001F5
CNTL_TRIS_MASK                    000000F5
CORRECT_INDEX_MENU                00000229
CORRECT_INDEX_MENU_2              00000236
CORRECT_INDEX_SUBMENU             0000028F
CORRECT_INDEX_SUBMENU_2           0000029D
CREATE_MENU_NAMES                 
CREATE_SUBMENU_NAMES              
CURSOR_DOWN_MENU                  0000025C
CURSOR_DOWN_SUBMENU               000002C5
CURSOR_UP_MENU                    00000256
CURSOR_UP_SUBMENU                 000002BE
DC                                00000001
DD_RAM_ADDR                       00000080
DD_RAM_UL                         00000080
DEBOUNCE_DELAY                    000002F4
DELAY_4MS                         00000000
DISP_OFF                          00000008
DISP_ON                           0000000C
DISP_ON_B                         0000000F
DISP_ON_C                         0000000E
DOWN                              PORTB,5
DRAW_KURSOR                       
DRAW_KURSOR_ROUTINE               000002F0
E                                 00000001
EEADR                             00000009
EECON1                            00000088
EECON2                            00000089
EEDATA                            00000008
EEIE                              00000006
EEIF                              00000004
END_ACTION                        000002CF
ENTER                             PORTB,6
ENTER_MENU                        00000267
ENTER_SUBMENU                     000002CD
ENTRY_DEC                         00000004
ENTRY_DEC_S                       00000005
ENTRY_INC                         00000006
ENTRY_INC_S                       00000007
EXIT                              PORTB,7
EXIT_DELAY                        .20
EXIT_MENU                         00000262
EXIT_SUBMENU                      000002CB
F                                 00000001
FIRST_STRING                      000002DE
FLAGS                             00000000
FSR                               00000004
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 47


SYMBOL TABLE
  LABEL                             VALUE 

GIE                               00000007
GOTO_PUNKT_MENU                   
GOTO_PUNKT_SUBMENU                
GOTO_PUNKT_SUBMENU_ACTION         
INDEX_MENU                        00000000
INDEX_SUBMENU                     00000001
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
KNOWN_ZERO                        00000000
LAST_SYMBOL_FIRST_LINE            0000008F
LAST_SYMBOL_SECOND_LINE           000000CF
LCD_CNTL                          00000005
LCD_CNTL_TRIS                     00000085
LCD_DATA                          00000006
LCD_DATA_TRIS                     00000086
LOOP_DELAY                        000002F7
LOOP_MENU                         00000247
LOOP_SUBMENU                      000002AF
MAIN                              00000000
MENU_1                            000000DD
MENU_1_SUBMENU_1_ACTION           000001E6
MENU_1_SUBMENU_2_ACTION           000001E7
MENU_1_SUBMENU_3_ACTION           000001E8
MENU_1_TABLE                      0000006E
MENU_1_TABLE_ACTION               000000AC
MENU_2                            000000EE
MENU_2_SUBMENU_1                  00000132
MENU_2_SUBMENU_1_ACTION           000001E9
MENU_2_SUBMENU_2_ACTION           000001EA
MENU_2_SUBMENU_3_ACTION           000001EB
MENU_2_TABLE                      00000076
MENU_2_TABLE_ACTION               000000B4
MENU_3                            000000FF
MENU_3_SUBMENU_1                  00000146
MENU_3_SUBMENU_1_ACTION           000001EC
MENU_3_SUBMENU_2                  0000015A
MENU_3_SUBMENU_2_ACTION           000001ED
MENU_3_SUBMENU_3_ACTION           000001EE
MENU_3_TABLE                      0000007F
MENU_3_TABLE_ACTION               000000BD
MENU_4                            00000110
MENU_4_SUBMENU_1                  0000016E
MENU_4_SUBMENU_1_ACTION           000001EF
MENU_4_SUBMENU_2                  00000182
MENU_4_SUBMENU_2_ACTION           000001F0
MENU_4_SUBMENU_3                  00000196
MENU_4_SUBMENU_3_ACTION           000001F1
MENU_4_TABLE                      00000089
MENU_4_TABLE_ACTION               000000C7
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 48


SYMBOL TABLE
  LABEL                             VALUE 

MENU_5                            00000121
MENU_5_SUBMENU_1                  000001AA
MENU_5_SUBMENU_1_ACTION           000001F2
MENU_5_SUBMENU_2                  000001BE
MENU_5_SUBMENU_2_ACTION           000001F3
MENU_5_SUBMENU_3                  000001D2
MENU_5_SUBMENU_3_ACTION           000001F4
MENU_5_TABLE                      00000094
MENU_5_TABLE_ACTION               000000D2
MENU_COUNTER                      00000003
MENU_HEANDLER                     0000020C
MENU_NAME_1                       "1.Menu_1"
MENU_NAME_2                       "2.Menu_2"
MENU_NAME_3                       "3.Menu_3"
MENU_NAME_4                       "4.Menu_4"
MENU_NAME_5                       "5.Menu_5"
MENU_SUBMENU_NAME_1_1             "1.1.SubMenu"
MENU_SUBMENU_NAME_1_2             "1.2.SubMenu"
MENU_SUBMENU_NAME_1_3             "1.3.SubMenu"
MENU_SUBMENU_NAME_2_1             "2.1.SubMenu"
MENU_SUBMENU_NAME_2_2             "2.2.SubMenu"
MENU_SUBMENU_NAME_2_3             "2.3.SubMenu"
MENU_SUBMENU_NAME_3_1             "3.1.SubMenu"
MENU_SUBMENU_NAME_3_2             "3.2.SubMenu"
MENU_SUBMENU_NAME_3_3             "3.3.SubMenu"
MENU_SUBMENU_NAME_4_1             "4.1.SubMenu"
MENU_SUBMENU_NAME_4_2             "4.2.SubMenu"
MENU_SUBMENU_NAME_4_3             "4.3.SubMenu"
MENU_SUBMENU_NAME_5_1             "5.1.SubMenu"
MENU_SUBMENU_NAME_5_2             "5.2.SubMenu"
MENU_SUBMENU_NAME_5_3             "5.3.SubMenu"
MOD_PCL                           
N                                 00000000
NEXT_STRING                       000002E8
NOT_PD                            00000003
NOT_RBPU                          00000007
NOT_TO                            00000004
NUM_OF_MAIN_MENU_PUNKTS           .5
NUM_OF_SUBMENU_PUNKTS_1           .0
NUM_OF_SUBMENU_PUNKTS_2           .1
NUM_OF_SUBMENU_PUNKTS_3           .2
NUM_OF_SUBMENU_PUNKTS_4           .3
NUM_OF_SUBMENU_PUNKTS_5           .3
NUM_OF_SUBMENU_TABLE              00000047
OFFSET                            00000000
ONLY_WRITE                        00000001
OPTION_REG                        00000081
OUT_ACTION_COMPLETE               000002D7
OUT_FIRST_STRING                  000002E5
OUT_NEXT_STRING                   000002EF
PCL                               00000002
PCLATH                            0000000A
POP                               
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 49


SYMBOL TABLE
  LABEL                             VALUE 

PORTA                             00000005
PORTB                             00000006
PRESSING_DOWN                     0000022E
PRESSING_DOWN_2                   00000295
PRESS_DOWN                        FLAGS,1
PRESS_ENTER                       FLAGS,2
PRESS_EXIT                        FLAGS,3
PRESS_UP                          FLAGS,0
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PUSH                              
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RD                                00000000
RETLW_NUM_OF_SUBMENU_PUNKTS       
RP0                               00000005
RP1                               00000006
RS                                00000003
SECOND_LINE                       000000C0
SECOND_STRING_ROUTINE             000001F9
SEND_LCD_COMMAND                  00000000
SEND_LCD_SYMBOL                   00000000
SKIP_CHECK_1                      0000021A
SKIP_CHECK_2                      0000027C
SKIP_CORRECT_INDEX_MENU_2         0000023B
SKIP_CORRECT_INDEX_MENU_3         0000023E
SKIP_CORRECT_INDEX_SUBMENU_2      000002A3
SKIP_CORRECT_INDEX_SUBMENU_3      000002A6
STATUS                            00000003
STRING_ACTION_COMPLETE            000002D0
STRING_MENU                       000001FD
STRING_SUBMENU                    00000205
SWITCH_ACTION                     0000009F
SWITCH_MENU                       0000020D
SWITCH_MENU_ROUTINE               000001FC
SWITCH_MENU_TABLE                 00000054
SWITCH_SUBMENU                    0000026C
SWITCH_SUBMENU_ROUTINE            00000204
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 50


SYMBOL TABLE
  LABEL                             VALUE 

SWITCH_SUBMENU_TABLE              00000061
SYMBOL_POINTER                    00000002
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
TABLE_ACTION_COMPLETE             00000000
TABLE_ZASTAVKA_FIRST_STRING       00000019
TABLE_ZASTAVKA_SECOND_STRING      00000030
TEMP_1                            00000004
TEMP_2                            00000005
TEMP_3                            00000006
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
UP                                PORTB,4
USE_4_BIT_MODE                    00000001
USE_HIGH_NIBLE                    00000000
USE_MENU_ACTION                   0
USE_MOVING_CURSOR                 1
USE_ONE_PORT                      00000000
USE_RBIE                          1
USE_SHORT_MOD_PCL                 1
USE_STATIC_CURSOR                 0
USE_TOP_LAST_CURSOR               1
W                                 00000000
WR                                00000001
WREN                              00000002
WRERR                             00000003
Y                                 00000001
Z                                 00000002
ZASTAVKA                          000002DC
ZASTAVKA_FIRST_STRING             "  MicroMenuLib"
ZASTAVKA_SECOND_STRING            "  ver 1.0 beta"
_CONFIG                           00002007
_CP_OFF                           00003FFF
_CP_ON                            0000000F
_FOSC_EXTRC                       00003FFF
MPASM  5.51                 MICROMENU_LIB.ASM   12-16-2018  10:46:09         PAGE 51


SYMBOL TABLE
  LABEL                             VALUE 

_FOSC_HS                          00003FFE
_FOSC_LP                          00003FFC
_FOSC_XT                          00003FFD
_HS_OSC                           00003FFE
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_LP_OSC                           00003FFC
_MICROMENU_02DA                   000002DA
_MICROMENU_02FD                   000002FD
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDTE_OFF                         00003FFB
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_XT_OSC                           00003FFD
__16F84                           00000001

Errors   :     0
Warnings :   168 reported,     0 suppressed
Messages :    38 reported,     0 suppressed

